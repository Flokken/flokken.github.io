(window.webpackJsonp=window.webpackJsonp||[]).push([[178],{506:function(s,a,e){"use strict";e.r(a);var t=e(4),n=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"k8s的资源管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s的资源管理"}},[s._v("#")]),s._v(" k8s的资源管理")]),s._v(" "),a("h3",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),a("blockquote",[a("p",[s._v("学习kubernets的核心，就是学习如何对集群中的"),a("code",[s._v("Pod")]),s._v("、"),a("code",[s._v("Pod控制器")]),s._v("、"),a("code",[s._v("Service")]),s._v("、"),a("code",[s._v("存储")]),s._v("等各种资源进行操作。")])]),s._v(" "),a("p",[s._v("在Kubernetes中，所有的内容都抽象为资源，用户需要通过操作资源来管理Kubernetes。")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/1609132417114-28600d3c-185f-4ded-9f5e-c0d77fb86d80.png"}}),s._v(" "),a("ul",[a("li",[a("p",[s._v("Kubernetes的本质就是一个集群系统，用户可以在集群中部署各种服务。所谓的部署服务，其实就是在Kubernetes集群中运行一个个的容器，并将指定的程序跑在容器中。")])]),s._v(" "),a("li",[a("p",[s._v("Pod: Kubernetes的最小管理单元是Pod而不是容器，"),a("strong",[s._v("所以只能将容器放在"),a("code",[s._v("Pod")]),s._v("中")]),s._v("，而Kubernetes一般也不会直接管理Pod**，而是通过"),a("code",[s._v("Pod控制器")]),s._v("来管理Pod的。**")])]),s._v(" "),a("li",[a("p",[s._v("Service:  Pod提供服务之后，就需要考虑如何访问Pod中的服务，Kubernetes提供了"),a("code",[s._v("Service")]),s._v("资源实现这个功能。")])]),s._v(" "),a("li",[a("p",[s._v("存储：如果Pod中程序的数据需要持久化，Kubernetes还提供了各种"),a("code",[s._v("存储")]),s._v("系统")])])]),s._v(" "),a("h3",{attrs:{id:"yaml语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#yaml语法"}},[s._v("#")]),s._v(" YAML语法")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("YAML是一个类似于XML、JSON的标记性语言。它强调的是以“数据”为中心，并不是以标记语言为重点。因而YAML本身的定义比较简单，号称是“一种人性化的数据格式语言”。")])]),s._v(" "),a("li",[a("p",[s._v("YAML的语法比较简单，主要有下面的几个特点：")])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("大小写敏感。")])])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("使用缩进表示层级关系。")])])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("缩进不允许使用tab，只允许空格（低版本限制）。")])])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("缩进的空格数不重要，只要相同层级的元素左对齐即可。")])])]),s._v(" "),a("li",[a("ul",[a("li",[s._v("‘#’表示注释。")])])])]),s._v(" "),a("p",[s._v("YAML支持以下几种数据类型：")]),s._v(" "),a("ul",[a("li",[s._v("常量：单个的、不可再分的值")]),s._v(" "),a("li",[s._v("对象：键值对的集合，又称为映射（mapping）/ 哈希（hash） / 字典（dictionary）")]),s._v(" "),a("li",[s._v("数组：一组按次序排列的值，又称为序列（sequence） / 列表（list）")])]),s._v(" "),a("h3",{attrs:{id:"举例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#举例"}},[s._v("#")]),s._v(" 举例")]),s._v(" "),a("p",[s._v("常量")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2 整型")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("c2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("234")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3 浮点型")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("c3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.14")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 4 null类型 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("c4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("~")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用~表示null")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("数组")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数组")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 形式一（推荐）：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 江苏\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 北京\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 形式二（了解）：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("江苏"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("上海"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("对象")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对象")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 形式一(推荐):")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("heima")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("age")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Beijing\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 形式二(了解):")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("heima")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("age")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Beijing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"资源管理方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资源管理方式"}},[s._v("#")]),s._v(" 资源管理方式")]),s._v(" "),a("blockquote",[a("p",[s._v("kubectl是kubernetes集群的命令行工具，通过它能够对集群本身进行管理，并能够在集群上进行容器化应用的安装和部署。")])]),s._v(" "),a("ul",[a("li",[s._v("命令式对象管理：直接使用命令去操作kubernetes的资源。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl run nginx-pod "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:1.17.1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("命令式对象配置：通过命令配置和配置文件去操作kubernetes的资源。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl create/patch "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" nginx-pod.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ul",[a("li",[s._v("声明式对象配置：通过apply命令和配置文件去操作kubernetes的资源。")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" nginx-pod.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("资源管理方式对比")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("类型")]),s._v(" "),a("th",[s._v("操作对象")]),s._v(" "),a("th",[s._v("适用环境")]),s._v(" "),a("th",[s._v("优点")]),s._v(" "),a("th",[s._v("缺点")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("命令式对象管理")]),s._v(" "),a("td",[s._v("对象")]),s._v(" "),a("td",[s._v("测试")]),s._v(" "),a("td",[s._v("简单")]),s._v(" "),a("td",[s._v("只能操作活动对象，无法审计、跟踪")])]),s._v(" "),a("tr",[a("td",[s._v("命令式对象配置")]),s._v(" "),a("td",[s._v("文件")]),s._v(" "),a("td",[s._v("开发")]),s._v(" "),a("td",[s._v("可以审计、跟踪")]),s._v(" "),a("td",[s._v("项目大时，配置文件多，操作麻烦")])]),s._v(" "),a("tr",[a("td",[s._v("声明式对象配置")]),s._v(" "),a("td",[s._v("目录")]),s._v(" "),a("td",[s._v("开发")]),s._v(" "),a("td",[s._v("支持目录操作")]),s._v(" "),a("td",[s._v("意外情况下难以调试")])])])]),s._v(" "),a("h4",{attrs:{id:"命令式对象管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命令式对象管理"}},[s._v("#")]),s._v(" 命令式对象管理")]),s._v(" "),a("p",[a("strong",[s._v("kubectl命令")])]),s._v(" "),a("p",[s._v("kubectl是kubernetes集群的命令行工具，通过它能够对集群本身进行管理，并能够在集群上进行容器化应用的安装部署。kubectl命令的语法如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kubectl [command] [type] [name] [flags]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("comand")]),s._v("：指定要对资源执行的操作，例如create、get、delete")]),s._v(" "),a("p",[a("strong",[s._v("type")]),s._v("：指定资源类型，比如deployment、pod、service")]),s._v(" "),a("p",[a("strong",[s._v("name")]),s._v("：指定资源的名称，名称大小写敏感")]),s._v(" "),a("p",[a("strong",[s._v("flags")]),s._v("：指定额外的可选参数")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 查看所有pod\nkubectl get pod \n\n# 查看某个pod\nkubectl get pod pod_name\n\n# 查看某个pod,以yaml格式展示结果\nkubectl get pod pod_name -o yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("strong",[s._v("资源类型")])]),s._v(" "),a("p",[s._v("kubernetes中所有的内容都抽象为资源，可以通过下面的命令进行查看:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kubectl api-resources\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("经常使用的资源有下面这些：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("资源分类")]),s._v(" "),a("th",[s._v("资源名称")]),s._v(" "),a("th",[s._v("缩写")]),s._v(" "),a("th",[s._v("资源作用")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("集群级别资源")]),s._v(" "),a("td",[s._v("nodes")]),s._v(" "),a("td",[s._v("no")]),s._v(" "),a("td",[s._v("集群组成部分")])]),s._v(" "),a("tr",[a("td",[s._v("namespaces")]),s._v(" "),a("td",[s._v("ns")]),s._v(" "),a("td",[s._v("隔离Pod")]),s._v(" "),a("td")]),s._v(" "),a("tr",[a("td",[s._v("pod资源")]),s._v(" "),a("td",[s._v("pods")]),s._v(" "),a("td",[s._v("po")]),s._v(" "),a("td",[s._v("装载容器")])]),s._v(" "),a("tr",[a("td",[s._v("pod资源控制器")]),s._v(" "),a("td",[s._v("replicationcontrollers")]),s._v(" "),a("td",[s._v("rc")]),s._v(" "),a("td",[s._v("控制pod资源")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("replicasets")]),s._v(" "),a("td",[s._v("rs")]),s._v(" "),a("td",[s._v("控制pod资源")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("deployments")]),s._v(" "),a("td",[s._v("deploy")]),s._v(" "),a("td",[s._v("控制pod资源")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("daemonsets")]),s._v(" "),a("td",[s._v("ds")]),s._v(" "),a("td",[s._v("控制pod资源")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("jobs")]),s._v(" "),a("td"),s._v(" "),a("td",[s._v("控制pod资源")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("cronjobs")]),s._v(" "),a("td",[s._v("cj")]),s._v(" "),a("td",[s._v("控制pod资源")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("horizontalpodautoscalers")]),s._v(" "),a("td",[s._v("hpa")]),s._v(" "),a("td",[s._v("控制pod资源")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("statefulsets")]),s._v(" "),a("td",[s._v("sts")]),s._v(" "),a("td",[s._v("控制pod资源")])]),s._v(" "),a("tr",[a("td",[s._v("服务发现资源")]),s._v(" "),a("td",[s._v("services")]),s._v(" "),a("td",[s._v("svc")]),s._v(" "),a("td",[s._v("统一pod对外接口")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("ingress")]),s._v(" "),a("td",[s._v("ing")]),s._v(" "),a("td",[s._v("统一pod对外接口")])]),s._v(" "),a("tr",[a("td",[s._v("存储资源")]),s._v(" "),a("td",[s._v("volumeattachments")]),s._v(" "),a("td"),s._v(" "),a("td",[s._v("存储")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("persistentvolumes")]),s._v(" "),a("td",[s._v("pv")]),s._v(" "),a("td",[s._v("存储")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("persistentvolumeclaims")]),s._v(" "),a("td",[s._v("pvc")]),s._v(" "),a("td",[s._v("存储")])]),s._v(" "),a("tr",[a("td",[s._v("配置资源")]),s._v(" "),a("td",[s._v("configmaps")]),s._v(" "),a("td",[s._v("cm")]),s._v(" "),a("td",[s._v("配置")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("secrets")]),s._v(" "),a("td"),s._v(" "),a("td",[s._v("配置")])])])]),s._v(" "),a("p",[a("strong",[s._v("操作")])]),s._v(" "),a("p",[s._v("kubernetes允许对资源进行多种操作，可以通过--help查看详细的操作命令")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kubectl --help\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("经常使用的操作有下面这些：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("命令分类")]),s._v(" "),a("th",[s._v("命令")]),s._v(" "),a("th",[s._v("翻译")]),s._v(" "),a("th",[s._v("命令作用")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("基本命令")]),s._v(" "),a("td",[s._v("create")]),s._v(" "),a("td",[s._v("创建")]),s._v(" "),a("td",[s._v("创建一个资源")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("edit")]),s._v(" "),a("td",[s._v("编辑")]),s._v(" "),a("td",[s._v("编辑一个资源")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("get")]),s._v(" "),a("td",[s._v("获取")]),s._v(" "),a("td",[s._v("获取一个资源")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("patch")]),s._v(" "),a("td",[s._v("更新")]),s._v(" "),a("td",[s._v("更新一个资源")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("delete")]),s._v(" "),a("td",[s._v("删除")]),s._v(" "),a("td",[s._v("删除一个资源")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("explain")]),s._v(" "),a("td",[s._v("解释")]),s._v(" "),a("td",[s._v("展示资源文档")])]),s._v(" "),a("tr",[a("td",[s._v("运行和调试")]),s._v(" "),a("td",[s._v("run")]),s._v(" "),a("td",[s._v("运行")]),s._v(" "),a("td",[s._v("在集群中运行一个指定的镜像")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("expose")]),s._v(" "),a("td",[s._v("暴露")]),s._v(" "),a("td",[s._v("暴露资源为Service")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("describe")]),s._v(" "),a("td",[s._v("描述")]),s._v(" "),a("td",[s._v("显示资源内部信息")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("logs")]),s._v(" "),a("td",[s._v("日志输出容器在 pod 中的日志")]),s._v(" "),a("td",[s._v("输出容器在 pod 中的日志")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("attach")]),s._v(" "),a("td",[s._v("缠绕进入运行中的容器")]),s._v(" "),a("td",[s._v("进入运行中的容器")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("exec")]),s._v(" "),a("td",[s._v("执行容器中的一个命令")]),s._v(" "),a("td",[s._v("执行容器中的一个命令")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("cp")]),s._v(" "),a("td",[s._v("复制")]),s._v(" "),a("td",[s._v("在Pod内外复制文件")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("rollout")]),s._v(" "),a("td",[s._v("首次展示")]),s._v(" "),a("td",[s._v("管理资源的发布")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("scale")]),s._v(" "),a("td",[s._v("规模")]),s._v(" "),a("td",[s._v("扩(缩)容Pod的数量")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("autoscale")]),s._v(" "),a("td",[s._v("自动调整")]),s._v(" "),a("td",[s._v("自动调整Pod的数量")])]),s._v(" "),a("tr",[a("td",[s._v("高级命令")]),s._v(" "),a("td",[s._v("apply")]),s._v(" "),a("td",[s._v("rc")]),s._v(" "),a("td",[s._v("通过文件对资源进行配置")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("label")]),s._v(" "),a("td",[s._v("标签")]),s._v(" "),a("td",[s._v("更新资源上的标签")])]),s._v(" "),a("tr",[a("td",[s._v("其他命令")]),s._v(" "),a("td",[s._v("cluster-info")]),s._v(" "),a("td",[s._v("集群信息")]),s._v(" "),a("td",[s._v("显示集群信息")])]),s._v(" "),a("tr",[a("td"),s._v(" "),a("td",[s._v("version")]),s._v(" "),a("td",[s._v("版本")]),s._v(" "),a("td",[s._v("显示当前Server和Client的版本")])])])]),s._v(" "),a("h5",{attrs:{id:"例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[s._v("#")]),s._v(" 例子")]),s._v(" "),a("p",[s._v("下面以一个namespace / pod的创建和删除简单演示下命令的使用：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个namespace")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create namespace dev")]),s._v("\nnamespace/dev created\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取namespace")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get ns")]),s._v("\nNAME              STATUS   AGE\ndefault           Active   21h\ndev               Active   21s\nkube-node-lease   Active   21h\nkube-public       Active   21h\nkube-system       Active   21h\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在此namespace下创建并运行一个nginx的Pod")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl run pod --image=nginx:latest -n dev")]),s._v("\nkubectl run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--generator")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("deployment/apps.v1 is DEPRECATED and will be removed "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" a future version. Use kubectl run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--generator")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("run-pod/v1 or kubectl create instead.\ndeployment.apps/pod created\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看新创建的pod")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n dev")]),s._v("\nNAME  READY   STATUS    RESTARTS   AGE\npod   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21s\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除指定的pod")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl delete pod pod-864f9875b9-pcw7x")]),s._v("\npod "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pod"')]),s._v(" deleted\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除指定的namespace")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl delete ns dev")]),s._v("\nnamespace "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev"')]),s._v(" deleted\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("h4",{attrs:{id:"命令式对象配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命令式对象配置"}},[s._v("#")]),s._v(" 命令式对象配置")]),s._v(" "),a("p",[s._v("命令式对象配置就是使用命令配合配置文件一起来操作kubernetes资源。")]),s._v(" "),a("p",[s._v("1） 创建一个nginxpod.yaml，内容如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("apiVersion: v1\nkind: Namespace\nmetadata:\n  name: dev\n\n---\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginxpod\n  namespace: dev\nspec:\n  containers:\n  - name: nginx-containers\n    image: nginx:latest\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("2）执行create命令，创建资源：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@master ~]# kubectl create -f nginxpod.yaml\nnamespace/dev created\npod/nginxpod created\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("此时发现创建了两个资源对象，分别是namespace和pod")]),s._v(" "),a("p",[s._v("3）执行get命令，查看资源：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@master ~]#  kubectl get -f nginxpod.yaml\nNAME            STATUS   AGE\nnamespace/dev   Active   18s\n\nNAME            READY   STATUS    RESTARTS   AGE\npod/nginxpod    1/1     Running   0          17s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("这样就显示了两个资源对象的信息")]),s._v(" "),a("p",[s._v("4）执行delete命令，删除资源：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[root@master ~]# kubectl delete -f nginxpod.yaml\nnamespace "dev" deleted\npod "nginxpod" deleted\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("此时发现两个资源对象被删除了")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("总结:\n    命令式对象配置的方式操作资源，可以简单的认为：命令  +  yaml配置文件（里面是命令需要的各种参数）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"声明式对象配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#声明式对象配置"}},[s._v("#")]),s._v(" 声明式对象配置")]),s._v(" "),a("p",[s._v("声明式对象配置跟命令式对象配置很相似，但是它只有一个命令apply。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 首先执行一次kubectl apply -f yaml文件，发现创建了资源\n[root@master ~]#  kubectl apply -f nginxpod.yaml\nnamespace/dev created\npod/nginxpod created\n\n# 再次执行一次kubectl apply -f yaml文件，发现说资源没有变动\n[root@master ~]#  kubectl apply -f nginxpod.yaml\nnamespace/dev unchanged\npod/nginxpod unchanged\n总结:\n    其实声明式对象配置就是使用apply描述一个资源最终的状态（在yaml中定义状态）\n    使用apply操作资源：\n        如果资源不存在，就创建，相当于 kubectl create\n        如果资源已存在，就更新，相当于 kubectl patch\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("blockquote",[a("p",[s._v("扩展：kubectl可以在node节点上运行吗 ?")])]),s._v(" "),a("p",[s._v("kubectl的运行是需要进行配置的，它的配置文件是$HOME/.kube，如果想要在node节点运行此命令，需要将master上的.kube文件复制到node节点上，即在master节点上执行下面操作：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("scp  -r  HOME/.kube   node1: HOME/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"使用场合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用场合"}},[s._v("#")]),s._v(" 使用场合")]),s._v(" "),a("ul",[a("li",[s._v("创建/更新资源 使用声明式对象配置 kubectl apply -f XXX.yaml")]),s._v(" "),a("li",[s._v("删除资源 使用命令式对象配置 kubectl delete -f XXX.yaml")]),s._v(" "),a("li",[s._v("查询资源 使用命令式对象管理 kubectl get(describe) 资源名称")])]),s._v(" "),a("h2",{attrs:{id:"实战案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实战案例"}},[s._v("#")]),s._v(" 实战案例")]),s._v(" "),a("p",[s._v("要求：在kubernetes集群中部署一个nginx服务，并且能够对其进行访问。")]),s._v(" "),a("h3",{attrs:{id:"namespace"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#namespace"}},[s._v("#")]),s._v(" Namespace")]),s._v(" "),a("p",[s._v("Namespace是kubernetes系统中的一种非常重要资源，它的主要作用是用来实现"),a("strong",[s._v("多套环境的资源隔离")]),s._v("或者"),a("strong",[s._v("多租户的资源隔离")]),s._v("。")]),s._v(" "),a("p",[s._v("默认情况下，kubernetes集群中的所有的Pod都是可以相互访问的。但是在实际中，可能不想让两个Pod之间进行互相的访问，那此时就可以将两个Pod划分到不同的namespace下。")]),s._v(" "),a("p",[a("strong",[s._v("可以通过kubernetes的授权机制，将不同的namespace交给不同租户进行管理，这样就实现了多租户的资源隔离。"),a("strong",[s._v("此时还能结合kubernetes的")]),s._v("资源配额机制")]),s._v("，限定不同租户能占用的资源，例如CPU使用量、内存使用量等等，来实现租户可用资源的管理。")]),s._v(" "),a("p",[s._v("比如下面的两个namespace")]),s._v(" "),a("img",{staticStyle:{zoom:"70%"},attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230806104148192.png"}}),s._v(" "),a("p",[s._v("kubernetes在集群启动之后，会默认创建几个namespace")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@master ~]# kubectl  get namespace\nNAME              STATUS   AGE\ndefault           Active   45h     #  所有未指定Namespace的对象都会被分配在default命名空间\nkube-node-lease   Active   45h     #  集群节点之间的心跳维护，v1.13开始引入\nkube-public       Active   45h     #  此命名空间下的资源可以被所有人访问（包括未认证用户）\nkube-system       Active   45h     #  所有由Kubernetes系统创建的资源都处于这个命名空间\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("查看")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1 查看所有的ns  命令：kubectl get ns")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get ns")]),s._v("\nNAME              STATUS   AGE\ndefault           Active   45h\nkube-node-lease   Active   45h\nkube-public       Active   45h     \nkube-system       Active   45h     \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2 查看指定的ns   命令：kubectl get ns ns名称")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get ns default")]),s._v("\nNAME      STATUS   AGE\ndefault   Active   45h\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3 指定输出格式  命令：kubectl get ns ns名称  -o 格式参数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#kubectl get ns default -o yaml")]),s._v("\napiVersion: v1\nkind: Namespace\nmetadata:\n  creationTimestamp: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2023-03-27T01:42:55Z"')]),s._v("\n  name: default\n  resourceVersion: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"151"')]),s._v("\n  selfLink: /api/v1/namespaces/default\n  uid: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24329682")]),s._v("-c203-4356-9884-c6a56e26dd43\nspec:\n  finalizers:\n  - kubernetes\nstatus:\n  phase: Active\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[a("strong",[s._v("创建")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 创建namespace\n[root@master ~]# kubectl create ns dev\nnamespace/dev created\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("删除")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# 删除namespace\n[root@master ~]# kubectl delete ns dev\nnamespace "dev" deleted\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("命令式对象配置")]),s._v(" "),a("p",[s._v("首先准备一个yaml文件：ns-dev.yaml")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("apiVersion: v1\nkind: Namespace\nmetadata:\n  name: dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("然后就可以执行对应的创建和删除命令了：")]),s._v(" "),a("p",[s._v("创建：kubectl create -f ns-dev.yaml")]),s._v(" "),a("p",[s._v("删除：kubectl delete -f ns-dev.yaml")]),s._v(" "),a("h3",{attrs:{id:"pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pod"}},[s._v("#")]),s._v(" Pod")]),s._v(" "),a("p",[s._v("Pod是kubernetes集群进行管理的最小单元，程序要运行必须部署在容器中，而容器必须存在于Pod中。")]),s._v(" "),a("p",[a("strong",[s._v("Pod可以认为是容器的封装，一个Pod中可以存在一个或者多个容器。")])]),s._v(" "),a("p",[s._v("kubernetes在集群启动之后，集群中的各个组件也都是以Pod方式运行的。可以通过下面命令查看：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[root@master ~]# kubectl get pod -n kube-system\nNAMESPACE     NAME                             READY   STATUS    RESTARTS   AGE\nkube-system   coredns-6955765f44-68g6v         1/1     Running   0          2d1h\nkube-system   coredns-6955765f44-cs5r8         1/1     Running   0          2d1h\nkube-system   etcd-master                      1/1     Running   0          2d1h\nkube-system   kube-apiserver-master            1/1     Running   0          2d1h\nkube-system   kube-controller-manager-master   1/1     Running   0          2d1h\nkube-system   kube-flannel-ds-amd64-47r25      1/1     Running   0          2d1h\nkube-system   kube-flannel-ds-amd64-ls5lh      1/1     Running   0          2d1h\nkube-system   kube-proxy-685tk                 1/1     Running   0          2d1h\nkube-system   kube-proxy-87spt                 1/1     Running   0          2d1h\nkube-system   kube-scheduler-master            1/1     Running   0          2d1h\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("Pod控制器：kubernetes没有提供单独运行Pod的命令，都是通过Pod控制器来实现的")]),s._v(" "),a("p",[a("strong",[s._v("创建并运行")])]),s._v(" "),a("p",[s._v("kubernetes没有提供单独运行Pod的命令，都是通过Pod控制器来实现的")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 命令格式： kubectl run (pod控制器名称) [参数] \n# --image  指定Pod的镜像\n# --port   指定端口\n# --namespace  指定namespace\n[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --namespace dev \ndeployment.apps/nginx created\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("查看")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 查看Pod基本信息\n[root@master ~]# kubectl get pods -n dev\nNAME    READY   STATUS    RESTARTS   AGE\nnginx   1/1     Running   0          43s\n\n# 查看Pod的详细信息\n[root@master ~]# kubectl describe pod nginx -n dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("strong",[s._v("访问Pod")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 获取podIP\n[root@master ~]# kubectl get pods -n dev -o wide\nNAME    READY   STATUS    RESTARTS   AGE    IP             NODE    ... \nnginx   1/1     Running   0          190s   10.244.1.23   node1   ...\n\n#访问POD\n[root@master ~]# curl http://10.244.1.23:80\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("strong",[s._v("删除指定Pod")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# 删除指定Pod\n[root@master ~]# kubectl delete pod nginx -n dev\npod "nginx" deleted\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("命令式对象配置")]),s._v(" "),a("p",[s._v("创建一个pod-nginx.yaml，内容如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  namespace: dev\nspec:\n  containers:\n  - image: nginx:latest\n    name: pod\n    ports:\n    - name: nginx-port\n      containerPort: 80\n      protocol: TCP\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("然后就可以执行对应的创建和删除命令了：")]),s._v(" "),a("p",[s._v("创建：kubectl create -f pod-nginx.yaml")]),s._v(" "),a("p",[s._v("删除：kubectl delete -f pod-nginx.yaml")]),s._v(" "),a("h3",{attrs:{id:"label"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#label"}},[s._v("#")]),s._v(" Label")]),s._v(" "),a("p",[s._v("Label是kubernetes系统中的一个重要概念。它的作用就是在资源上添加标识，用来对它们进行区分和选择。")]),s._v(" "),a("p",[s._v("Label的特点：")]),s._v(" "),a("ul",[a("li",[s._v("一个Label会以key/value键值对的形式附加到各种对象上，如Node、Pod、Service等等")]),s._v(" "),a("li",[s._v("一个资源对象可以定义任意数量的Label ，同一个Label也可以被添加到任意数量的资源对象上去")]),s._v(" "),a("li",[s._v("Label通常在资源对象定义时确定，当然也可以在对象创建后动态添加或者删除")])]),s._v(" "),a("blockquote",[a("p",[s._v("一些常用的Label 示例如下：")]),s._v(" "),a("ul",[a("li",[s._v('版本标签："version":"release", "version":"stable"......')]),s._v(" "),a("li",[s._v('环境标签："environment":"dev"，"environment":"test"，"environment":"pro"')]),s._v(" "),a("li",[s._v('架构标签："tier":"frontend"，"tier":"backend"')])])]),s._v(" "),a("p",[a("strong",[s._v("Label Selector：")])]),s._v(" "),a("p",[s._v("标签定义完毕之后，还要考虑到标签的选择，这就要使用到Label Selector，即：")]),s._v(" "),a("ul",[a("li",[s._v("Label用于给某个资源对象定义标识")]),s._v(" "),a("li",[s._v("Label Selector用于查询和筛选拥有某些标签的资源对象\n"),a("ul",[a("li",[s._v("基于等式的Label Selector\n"),a("ul",[a("li",[s._v('比如： name = slave: 选择所有包含Label中key="name"且value="slave"的对象')])])]),s._v(" "),a("li",[s._v("基于集合的Label Selector\n"),a("ul",[a("li",[s._v('比如：name in (master, slave): 选择所有包含Label中的key="name"且value="master"或"slave"的对象')])])])])])]),s._v(" "),a("p",[s._v("命令方式")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 为pod资源打标签\n[root@master ~]# kubectl label pod nginx-pod version=1.0 -n dev\npod/nginx-pod labeled\n\n# 为pod资源更新标签\n[root@master ~]# kubectl label pod nginx-pod version=2.0 -n dev --overwrite\npod/nginx-pod labeled\n\n# 查看标签\n[root@master ~]# kubectl get pod nginx-pod  -n dev --show-labels\nNAME        READY   STATUS    RESTARTS   AGE   LABELS\nnginx-pod   1/1     Running   0          10m   version=2.0\n\n# 筛选标签\n[root@master ~]# kubectl get pod -n dev -l version=2.0  --show-labels\nNAME        READY   STATUS    RESTARTS   AGE   LABELS\nnginx-pod   1/1     Running   0          17m   version=2.0\n[root@master ~]# kubectl get pod -n dev -l version!=2.0 --show-labels\nNo resources found in dev namespace.\n\n#删除标签\n[root@master ~]# kubectl label pod nginx-pod -n dev tier-\npod/nginx unlabeled\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("命令式对象配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('apiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  namespace: dev\n  labels:\n    version: "3.0" \n    env: "test"\nspec:\n  containers:\n  - image: nginx:latest\n    name: pod\n    ports:\n    - name: nginx-port\n      containerPort: 80\n      protocol: TCP\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("然后就可以执行对应的更新命令了：kubectl apply -f pod-nginx.yaml")]),s._v(" "),a("h3",{attrs:{id:"deployment-pod控制器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deployment-pod控制器"}},[s._v("#")]),s._v(" Deployment（Pod控制器）")]),s._v(" "),a("p",[s._v("在kubernetes中，Pod是最小的控制单元，"),a("strong",[s._v("但是kubernetes很少直接控制Pod，一般都是通过Pod控制器来完成的。")])]),s._v(" "),a("p",[s._v("Pod控制器用于pod的管理，确保pod资源符合预期的状态，"),a("strong",[s._v("当pod的资源出现故障时，会尝试进行重启或重建pod。")])]),s._v(" "),a("blockquote",[a("p",[s._v("也即是一般要不去直接操作pod，而是用deploy这样的控制器来管理，包括增删改查")])]),s._v(" "),a("img",{staticStyle:{zoom:"70%"},attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230806211034759.png"}}),s._v(" "),a("blockquote",[a("p",[s._v("下面的命令中，deployment简写成deploy，效果一样")])]),s._v(" "),a("p",[s._v("创建deployment")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#示例：在名称为test的命名空间下创建名为nginx的deployment,里面有三个装了nginx的pod，如果没有指明个数是一个")]),s._v("\nkubectl create deployment nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--image")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:1.17.1 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replicas")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#没有指定镜像，会默认用k8s中的默认镜像busybox，然后创建一个pod")]),s._v("\nkubectl create deployment nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#scale和replica可以重新指定个数")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#在名称为test的命名空间下，在名为nginx的deployment再创建3个Pod，加上原来的一个就是4个，基于的镜像就是创建这个控制器时的镜像")]),s._v("\nkubectl scale deployment nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--replicas")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("查看deploy")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#dev是namespce，-n就是指定某个namespace")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看创建的Pod")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n dev")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看deployment的信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get deploy -n dev")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看deployment的详细信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe deploy nginx -n dev")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl delete deploy nginx -n dev")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("命令式对象配置")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" dev\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h3",{attrs:{id:"service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service"}},[s._v("#")]),s._v(" Service")]),s._v(" "),a("p",[a("strong",[s._v("利用Deployment来创建一组Pod来提供具有高可用性的服务。")])]),s._v(" "),a("p",[s._v("虽然每个Pod都会分配一个单独的Pod IP，然而却存在如下两问题：")]),s._v(" "),a("ul",[a("li",[s._v("Pod IP 会随着Pod的重建产生变化\n"),a("ul",[a("li",[s._v("比如上面的scale进而replica，内部就会涉及删除或者创建pod")])])]),s._v(" "),a("li",[s._v("Pod IP 仅仅是集群内可见的虚拟IP，外部无法访问")])]),s._v(" "),a("p",[a("strong",[s._v("这样对于访问这个服务带来了难度")]),s._v("。因此，kubernetes设计了Service来解决这个问题。")]),s._v(" "),a("p",[s._v("！！！Service可以看作是一组同类Pod"),a("strong",[s._v("对外的访问接口")]),s._v("。借助Service，应用可以方便地实现服务发现和负载均衡。")]),s._v(" "),a("blockquote",[a("p",[s._v("也就是说，集群里要访问一组pod的时候，应该通过这个service（其实就是ip和端口）去访问")])]),s._v(" "),a("img",{staticStyle:{zoom:"70%"},attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230806220332292.png"}}),s._v(" "),a("p",[s._v("创建集群内部可访问的Service")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露Service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl expose deploy nginx --name=svc-nginx1 --type=ClusterIP --port=80 --target-port=80 -n dev")]),s._v("\nservice/svc-nginx1 exposed\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc svc-nginx1 -n dev -o wide")]),s._v("\nNAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("   AGE     SELECTOR\nsvc-nginx1   ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.109")]),s._v(".179.231   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP    3m51s   "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里产生了一个CLUSTER-IP，这就是service的IP，在Service的生命周期中，这个地址是不会变动的")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以通过这个IP访问当前service对应的POD")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl 10.109.179.231:80")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("DOCTYPE html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("head"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Welcome to nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/head"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("Welcome to nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/h"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/html"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("创建集群外部也可访问的Service")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 上面创建的Service的type类型为ClusterIP，这个ip地址只用集群内部可访问\n# 如果需要创建外部也可以访问的Service，需要修改type为NodePort\n[root@master ~]# kubectl expose deploy nginx --name=svc-nginx2 --type=NodePort --port=80 --target-port=80 -n dev\nservice/svc-nginx2 exposed\n\n# 此时查看，会发现出现了NodePort类型的Service，而且有一对Port（80:31928/TC）\n[root@master ~]# kubectl get svc  svc-nginx2  -n dev -o wide\nNAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE    SELECTOR\nsvc-nginx2    NodePort    10.100.94.0      <none>        80:31928/TCP   9s     run=nginx\n\n# 接下来就可以通过集群外的主机访问 节点IP:31928访问服务了\n# 例如在的电脑主机上通过浏览器访问下面的地址\nhttp://192.168.90.100:31928/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("删除Service")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[root@master ~]# kubectl delete svc svc-nginx-1 -n dev \nservice "svc-nginx-1" deleted\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("命令式对象配置")]),s._v(" "),a("p",[s._v("创建一个svc-nginx.yaml，内容如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("apiVersion: v1\nkind: Service\nmetadata:\n  name: svc-nginx\n  namespace: dev\nspec:\n  clusterIP: 10.109.179.231 #固定的内网ip\n  ports:\n  - port: 80\n    protocol: TCP\n    targetPort: 80\n  selector:\n    run: nginx\n  type: ClusterIP\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("然后就可以执行对应的创建和删除命令了：")]),s._v(" "),a("p",[s._v("创建：kubectl create -f svc-nginx.yaml")]),s._v(" "),a("p",[s._v("删除：kubectl delete -f svc-nginx.yaml")])])}),[],!1,null,null,null);a.default=n.exports}}]);