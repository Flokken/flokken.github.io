(window.webpackJsonp=window.webpackJsonp||[]).push([[197],{524:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("blockquote",[t("p",[s._v("参考链接：")]),s._v(" "),t("p",[s._v("https://www.cnblogs.com/blogwd/p/15780478.html")]),s._v(" "),t("p",[s._v("https://docs.scrapy.org/en/latest/")])]),s._v(" "),t("h2",{attrs:{id:"一-查看网站-明确爬取信息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一-查看网站-明确爬取信息"}},[s._v("#")]),s._v(" 一 查看网站，明确爬取信息")]),s._v(" "),t("p",[s._v("爬取网站，站长之家的行业网站排行榜的信息。链接https://top.chinaz.com/all/")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230306164328494.png",alt:"image-20230306164328494"}})]),s._v(" "),t("p",[s._v("需要爬取图中标出五个字段：")]),s._v(" "),t("ul",[t("li",[s._v("web_name")]),s._v(" "),t("li",[s._v("rank")]),s._v(" "),t("li",[s._v("domin")]),s._v(" "),t("li",[s._v("description")]),s._v(" "),t("li",[s._v("score")])]),s._v(" "),t("h2",{attrs:{id:"二构建项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二构建项目"}},[s._v("#")]),s._v(" 二构建项目")]),s._v(" "),t("p",[t("code",[s._v("scrapy startproject ZhanZhangZhiJia")]),s._v("新建一个项目")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230301104700817.png",alt:"image-20230301104700817"}})]),s._v(" "),t("p",[s._v("解释一下目录结构：")]),s._v(" "),t("div",{staticClass:"language-text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("scrapy_demo\n├── scrapy_demo\n│   ├── items.py       # 数据模型文件\n│   ├── middlewares.py # 中间件文件，配置所有中间件\n│   ├── pipelines.py   #  pipeline 文件，用于存放自定义pipeline的处理逻辑，比如配置保存数据库的逻辑\n│   ├── settings.py    # 项目的配置文件，自定义的外部配置都可以放在这里\n│   └── spiders        # Spider类文件夹，我们编写的解析代码均存放在这里\n└── scrapy.cfg         # 项目的部署配置文件\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("可以用scrapy shell测试能否获取网页源码")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("scrapy shell https://top.chinaz.com/all/ --nolog\n[s] Available Scrapy objects:\n[s]   scrapy     scrapy module (contains scrapy.Request, scrapy.Selector, etc)\n[s]   crawler    <scrapy.crawler.Crawler object at 0x0000011BEAE84748>\n[s]   item       {}\n[s]   request    <GET https://top.chinaz.com/hangye/index_wangluo.html>\n[s]   response   <200 https://top.chinaz.com/hangye/index_wangluo.html>\n[s]   settings   <scrapy.settings.Settings object at 0x0000011BEB0F1B88>\n[s]   spider     <TechWebSpider 'tech_web' at 0x11beb538488>\n[s] Useful shortcuts:\n[s]   fetch(url[, redirect=True]) Fetch URL and update local objects (by default, redirects are followed)\n[s]   fetch(req)                  Fetch a scrapy.Request and update local objects\n[s]   shelp()           Shell help (print this help)\n[s]   view(response)    View response in a browser\nIn [1]: \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("此时你可以使用 "),t("code",[s._v("response.text")]),s._v(" 来检查我们是否获取了整个页面的源码，scrapy的所有资源解析操作都被集成在了"),t("code",[s._v("response")]),s._v("这个对象中，使用 "),t("code",[s._v("Tab")]),s._v(" 建可以提示补全相关的内容。")]),s._v(" "),t("h3",{attrs:{id:"spider编写"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#spider编写"}},[s._v("#")]),s._v(" "),t("strong",[s._v("spider编写")])]),s._v(" "),t("p",[s._v("首先使用 scrapy genspider demoSpider https://top.chinaz.com/all/  创建一个爬虫如下")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230306154731225.png",alt:"image-20230306154731225"}})]),s._v(" "),t("p",[s._v("并且我们需要爬取的列表在这里，使用xpath定位资源")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230306155104687.png",alt:"image-20230306155104687"}})]),s._v(" "),t("p",[s._v("xpath规则如下：")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("表达式")]),s._v(" "),t("th",[s._v("说明")]),s._v(" "),t("th",[s._v("举例")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[t("code",[s._v("/")])]),s._v(" "),t("td",[s._v("从当前节点选取直接子节点")]),s._v(" "),t("td",[t("strong",[s._v("/html/div/span")])])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("//")])]),s._v(" "),t("td",[s._v("从当前节点选取子孙节点")]),s._v(" "),t("td",[t("strong",[s._v("//input")])])]),s._v(" "),t("tr",[t("td",[t("code",[s._v(".")])]),s._v(" "),t("td",[s._v("选取当前节点")]),s._v(" "),t("td")]),s._v(" "),t("tr",[t("td",[t("code",[s._v("..")])]),s._v(" "),t("td",[s._v("选取当前节点的父节点")]),s._v(" "),t("td",[t("strong",[s._v("//input/..")]),s._v(" 会选取 input 的父节点")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("@")])]),s._v(" "),t("td",[s._v("选取属性，或者根据属性选取")]),s._v(" "),t("td",[t("strong",[s._v("//input[@data]")]),s._v(" 选取具备 data 属性的 input 元素   //@data 选取所有 data 属性")])]),s._v(" "),t("tr",[t("td",[t("code",[s._v("*")])]),s._v(" "),t("td",[s._v("通配符，表示任意节点或任意属性")]),s._v(" "),t("td")])])]),s._v(" "),t("p",[s._v("除此之外，xpath表达式中可以使用text()来获取文本。")]),s._v(" "),t("p",[s._v("并且该网站的url构造十分简单，第一页是https://top.chinaz.com/all/index.html，第二页是https://top.chinaz.com/all/index_2.html,因此可以根据url构造规律来爬取接下来的网页。")]),s._v(" "),t("p",[s._v("最终，demoSpider的代码如下：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" scrapy\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" datetime\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" hashlib "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" md5\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ZhanzhangzhijiaItem\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Demospider")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scrapy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Spider"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"demoSpider"')]),s._v("\n    allowed_domains "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"top.chinaz.com"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    start_urls "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://top.chinaz.com/all/index.html"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://top.chinaz.com/all/index_{}.html'")]),s._v("\n    pagesize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("parse")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        li_list "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" response"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xpath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'//ul[@class=\"listCentent\"]/li'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这样会返回所有的li")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" li "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" li_list"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            web_name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" li"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xpath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.//h3/a/text()'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#因为li中是已经提取出的列表，因此加上.表示从当前节点也就是li开始提取")]),s._v("\n            domain "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" li"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xpath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.//h3/span/text()'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#h3下面有多个span，默认匹配第一个，正好第一个就是domain")]),s._v("\n            description "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" li"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xpath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./div[@class=\"CentTxt\"]/p/text()'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            rank "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" li"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xpath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.//div[@class=\"RtCRateCent\"]/strong/text()'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            score "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" li"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xpath"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.//div[@class=\"RtCRateCent\"]/span/text()'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 封装数据")]),s._v("\n            item "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ZhanzhangzhijiaItem"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            date "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" datetime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("datetime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("now"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'_id'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" md5"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("web_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hexdigest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'web_name'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" web_name\n            item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'domain'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" domain\n            item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'abstract'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" description\n            item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rank'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rank\n            item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'score'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" score\n            item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'create_time'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" date\n            item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'update_time'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" date\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("yield")]),s._v(" item\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构造下一页的请求")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pagesize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pagesize "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pagesize"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pagesize"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("yield")]),s._v(" scrapy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Request"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parse"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("p",[s._v("运行spider,注意是name不是文件名")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("scrapy crawl demoSpider\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("但是这样只会在控制台输出结果，因此需要保存爬取的文件")]),s._v(" "),t("p",[s._v("可以用-o命令指定保存文件")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Scrapy` 提供了许多`Feed exports`的方法，可以将输出数据保存为`json, json lines, csv, xml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在启动命令后面加 "),t("code",[s._v("-o xx.json")]),s._v(" 就可以将文件保存为"),t("code",[s._v("json")]),s._v("格式。")]),s._v(" "),t("p",[s._v("例如使用如下命令将抓取的数据保存到一个 "),t("code",[s._v("json")]),s._v(" 文件中：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("scrapy crawl demoSpider "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" result.json\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("打开保存的 json 文件，发现出现了乱码，出于历史原因，JSON 输出使用安全数字编码（"),t("code",[s._v("\\uXXXX")]),s._v("序列），如果想要 UTF-8 用于 JSON，请使用 "),t("code",[s._v("FEED_EXPORT_ENCODING = 'utf-8'")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"书写pipeline文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#书写pipeline文件"}},[s._v("#")]),s._v(" "),t("strong",[s._v("书写Pipeline文件")])]),s._v(" "),t("p",[s._v("其次需要介绍一下 "),t("code",[s._v("scrapy")]),s._v(" 的 "),t("code",[s._v("pipeline")]),s._v(" ，在每一个item 被抓取之后，都会被发送到 "),t("code",[s._v("pipeline")]),s._v(" 中，每个 "),t("code",[s._v("pipeline")]),s._v(" 都是一个实现简单方法的 "),t("code",[s._v("python")]),s._v(" 类，")]),s._v(" "),t("p",[s._v("它们接收一个 "),t("code",[s._v("item")]),s._v(" 并对其执行操作，同时决定该 "),t("code",[s._v("item")]),s._v(" 是应该继续进入下一个 "),t("code",[s._v("pipeline")]),s._v(" 还是被丢弃不再处理。")]),s._v(" "),t("p",[t("strong",[s._v("pipeline 的典型用途如下：")])]),s._v(" "),t("ul",[t("li",[s._v("清洗 HTML 数据")]),s._v(" "),t("li",[s._v("验证抓取的数据（检查项目是否包含某些字段）")]),s._v(" "),t("li",[s._v("检查重复项（并删除它们）")]),s._v(" "),t("li",[s._v("将抓取的项目存储在数据库中")])]),s._v(" "),t("p",[t("strong",[s._v("编写自己的 pipeline")])]),s._v(" "),t("p",[s._v("每个 pipeline 组件都是一个必须实现 "),t("code",[s._v("process_item")]),s._v(" 方法的 Python 类：")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("process_item ( *self* , *item* , *spider* )"),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/item-pipeline.html#process_item",target:"_blank",rel:"noopener noreferrer"}},[s._v("¶参考"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("处理每个 item 都会调用此方法。item是一个"),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/items.html#item-types",target:"_blank",rel:"noopener noreferrer"}},[s._v("item 对象"),t("OutboundLink")],1),s._v("，请参阅 "),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/items.html#supporting-item-types",target:"_blank",rel:"noopener noreferrer"}},[s._v("支持所有项目类型"),t("OutboundLink")],1),s._v("。"),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/item-pipeline.html#process_item",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("process_item()")]),t("OutboundLink")],1),s._v("必须要么：返回一个"),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/items.html#item-types",target:"_blank",rel:"noopener noreferrer"}},[s._v("项目对象"),t("OutboundLink")],1),s._v("，返回一个"),t("a",{attrs:{href:"https://twistedmatrix.com/documents/current/api/twisted.internet.defer.Deferred.html",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("Deferred")]),t("OutboundLink")],1),s._v("或引发 "),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/exceptions.html#scrapy.exceptions.DropItem",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("DropItem")]),t("OutboundLink")],1),s._v("异常。丢弃的项目不再由进一步的 pipeline 组件处理。")]),s._v(" "),t("p",[s._v("参数")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("item")]),s._v(" ( "),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/items.html#item-types",target:"_blank",rel:"noopener noreferrer"}},[s._v("item object"),t("OutboundLink")],1),s._v(" ) – 抓取的项目")]),s._v(" "),t("li",[t("strong",[s._v("spider")]),s._v(" ( "),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/spiders.html#scrapy.spiders.Spider",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("Spider")]),t("OutboundLink")],1),s._v("object) – 抓取物品的spider")])]),s._v(" "),t("p",[s._v("返回值")]),s._v(" "),t("ul",[t("li",[s._v("返回一个 "),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/items.html#item-types",target:"_blank",rel:"noopener noreferrer"}},[s._v("Item 对象"),t("OutboundLink")],1),s._v("，让后续的 pipeline 处理")]),s._v(" "),t("li",[s._v("返回一个"),t("a",{attrs:{href:"https://twistedmatrix.com/documents/current/api/twisted.internet.defer.Deferred.html",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("Deferred")]),t("OutboundLink")],1),s._v("或引发 "),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/exceptions.html#scrapy.exceptions.DropItem",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("DropItem")]),t("OutboundLink")],1),s._v("异常，丢弃 item 不再由后续的 pipeline 组件处理。")])])])]),s._v(" "),t("p",[s._v("此外，它们还可以实现以下方法：")]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("open_spider（self，spider）")]),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/item-pipeline.html#open_spider",target:"_blank",rel:"noopener noreferrer"}},[s._v("¶"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("这个方法在 spider 打开时被调用。参数"),t("strong",[s._v("spider")]),s._v("– 打开的 spider")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("close_spider（self，spider）")]),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/item-pipeline.html#close_spider",target:"_blank",rel:"noopener noreferrer"}},[s._v("¶"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("当 spider 关闭时调用此方法。参数 "),t("strong",[s._v("spider")]),s._v(" – 关闭的spider")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("from_crawler ( *cls* , *crawler* )")]),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/item-pipeline.html#from_crawler",target:"_blank",rel:"noopener noreferrer"}},[s._v("¶参考"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("如果存在，必须返回 pipeline 的新实例，通常在这个方法中传入一些外部配置，构造一个新的 pipeline 实例。Crawler 对象提供对所有 Scrapy 核心组件的访问，如 settings 和 signals ；这是 pipeline 访问它们并将其功能挂钩到 Scrapy 的一种方式。参数"),t("strong",[s._v("crawler")]),s._v(" ( "),t("a",{attrs:{href:"https://docs.scrapy.org/en/latest/topics/api.html#scrapy.crawler.Crawler",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("Crawler")]),t("OutboundLink")],1),s._v("object) – 使用这个 pipeline 的爬虫。")])])]),s._v(" "),t("p",[s._v("知道了 pipeline 的作用和定义方法后，我们定义一个保存数据到 "),t("code",[s._v("mongodb")]),s._v(" 的 "),t("code",[s._v("pipeline")]),s._v(" ，如下所示：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Define your item pipelines here")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Don't forget to add your pipeline to the ITEM_PIPELINES setting")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See: https://docs.scrapy.org/en/latest/topics/item-pipeline.html")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# useful for handling different item types with a single interface")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" pymongo\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" itemadapter "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ItemAdapter\n\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ZhanzhangzhijiaPipeline")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("process_item")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" spider"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" item\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("saveToMongoPipelines")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("__init__")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("mongo_url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("mongo_db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("collection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mongo_url"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mongo_url\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mongo_db "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mongo_db\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("collection "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" collection\n    "),t("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@classmethod")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("from_crawler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("crawler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#参数cls就是class的缩写，他相当于__init__，因此需要给里面的参数传参")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n          Scrapy会先通过getattr判断我们是否自定义了from_crawler,有则调它来完\n          成实例化,早于__init__方法执行\n  　　　　 自己要的参数要去settings.py文件配置　　　　\n        """')]),s._v("\n        env "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" crawler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("settings"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ENV'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'local'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        config "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" crawler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("settings"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'CONFIG'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        config "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("env"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        mongo_url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("MONGO_URL\n        mongo_db "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("MONGODB_DB\n        collection "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("COLLECTION_NAME\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" cls"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n            mongo_url "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mongo_url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            mongo_db "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" mongo_db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            collection "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" collection\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open_spider")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("spider"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n        打开spider的时候调用一次，可以在这里创建连接\n        """')]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pymongo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("MongoClient"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mongo_url"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("db "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mongo_db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("process_item")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("spider"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n        每一个item都会调用的方法，可以在这里清洗数据，保存到数据库\n        :return:\n        """')]),s._v("\n        adapter "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ItemAdapter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        coll "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("collection"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 ItemAdapter 的 asdict() 方法可以处理嵌套的 item 格式，获取 json 字符串")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#下面的代码为了查重")]),s._v("\n        doc "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" adapter"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("asdict"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" coll"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("count_documents"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'_id'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" doc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'_id'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" count "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            coll"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("insert_one"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("doc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("del")]),s._v(" doc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'create_time'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n            coll"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update_one"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_id"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" doc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'_id'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$set'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" doc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" item\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("close_spider")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("spider"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n        spider关闭时调用一次，可以关闭连接，释放资源\n        """')]),s._v("\n        self"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("close"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br")])]),t("p",[t("code",[s._v("ITEM_PIPELINES")]),s._v(" 是一个字典，它的 "),t("code",[s._v("key")]),s._v(" 是 "),t("code",[s._v("pipeline")]),s._v(" 的类路径，它的值是一个数字， 这个数字决定了 pipeline 的执行顺序，它的执行顺序为从低到高，数字越大越后执行，自定义的数字范围为 "),t("code",[s._v("0 - 1000")]),s._v("。")]),s._v(" "),t("p",[s._v("上述的pipeline 中的 "),t("code",[s._v("from_crawler")]),s._v(" 方法使用了 settings 中配置的 "),t("code",[s._v("mongodb")]),s._v(" 的地址，"),t("code",[s._v("settings.py")]),s._v(" 文件的配置如下所示：")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Scrapy settings for ZhanZhangZhiJia project")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# For simplicity, this file contains only settings considered important or")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# commonly used. You can find more settings consulting the documentation:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     https://docs.scrapy.org/en/latest/topics/settings.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     https://docs.scrapy.org/en/latest/topics/downloader-middleware.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     https://docs.scrapy.org/en/latest/topics/spider-middleware.html")]),s._v("\n\nBOT_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ZhanZhangZhiJia"')]),s._v("\n\nSPIDER_MODULES "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ZhanZhangZhiJia.spiders"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nNEWSPIDER_MODULE "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ZhanZhangZhiJia.spiders"')]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Crawl responsibly by identifying yourself (and your website) on the user-agent")]),s._v("\nUSER_AGENT "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36 Edg/104.0.1293.70'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Obey robots.txt rules")]),s._v("\nROBOTSTXT_OBEY "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Override the default request headers:")]),s._v("\nDEFAULT_REQUEST_HEADERS "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Accept'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Accept-Encoding'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gzip, deflate, br'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Accept-Language'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zh-CN,zh;q=0.9,en;q=0.8'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Connection'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'keep-alive'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'User-Agent'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" USER_AGENT\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Configure maximum concurrent requests performed by Scrapy (default: 16)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CONCURRENT_REQUESTS = 32")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Configure a delay for requests for the same website (default: 0)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See https://docs.scrapy.org/en/latest/topics/settings.html#download-delay")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See also autothrottle settings and docs")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DOWNLOAD_DELAY = 3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The download delay setting will honor only one of:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CONCURRENT_REQUESTS_PER_DOMAIN = 16")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#CONCURRENT_REQUESTS_PER_IP = 16")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Disable cookies (enabled by default)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#COOKIES_ENABLED = False")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Disable Telnet Console (enabled by default)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#TELNETCONSOLE_ENABLED = False")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Override the default request headers:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DEFAULT_REQUEST_HEADERS = {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#    "Accept-Language": "en",')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Enable or disable spider middlewares")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See https://docs.scrapy.org/en/latest/topics/spider-middleware.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#SPIDER_MIDDLEWARES = {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#    "ZhanZhangZhiJia.middlewares.ZhanzhangzhijiaSpiderMiddleware": 543,')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Enable or disable downloader middlewares")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See https://docs.scrapy.org/en/latest/topics/downloader-middleware.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DOWNLOADER_MIDDLEWARES = {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#    "ZhanZhangZhiJia.middlewares.ZhanzhangzhijiaDownloaderMiddleware": 543,')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Enable or disable extensions")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See https://docs.scrapy.org/en/latest/topics/extensions.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#EXTENSIONS = {")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#    "scrapy.extensions.telnet.TelnetConsole": None,')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Configure item pipelines")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See https://docs.scrapy.org/en/latest/topics/item-pipeline.html")]),s._v("\nITEM_PIPELINES "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ZhanZhangZhiJia.pipelines.saveToMongoPipelines"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Enable and configure the AutoThrottle extension (disabled by default)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See https://docs.scrapy.org/en/latest/topics/autothrottle.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#AUTOTHROTTLE_ENABLED = True")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The initial download delay")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#AUTOTHROTTLE_START_DELAY = 5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The maximum download delay to be set in case of high latencies")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#AUTOTHROTTLE_MAX_DELAY = 60")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The average number of requests Scrapy should be sending in parallel to")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# each remote server")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#AUTOTHROTTLE_TARGET_CONCURRENCY = 1.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Enable showing throttling stats for every response received:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#AUTOTHROTTLE_DEBUG = False")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Enable and configure HTTP caching (disabled by default)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# See https://docs.scrapy.org/en/latest/topics/downloader-middleware.html#httpcache-middleware-settings")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#HTTPCACHE_ENABLED = True")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#HTTPCACHE_EXPIRATION_SECS = 0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#HTTPCACHE_DIR = "httpcache"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#HTTPCACHE_IGNORE_HTTP_CODES = []")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#HTTPCACHE_STORAGE = "scrapy.extensions.httpcache.FilesystemCacheStorage"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LocalConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 本地环境mongeDB地址")]),s._v("\n    MONGODB_HOST "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:27017'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MONGODB_USERNAME = 'root'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MONGODB_PASSWORD = 'password123'")]),s._v("\n    MONGODB_DB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),s._v("\n    COLLECTION_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'demoScrapy'")]),s._v("\n    MONGO_URL "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mongodb://{server}/{database}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" \\\n        "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" server"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MONGODB_HOST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" database"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MONGODB_DB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# format(username=MONGODB_USERNAME, password=MONGODB_PASSWORD, server=MONGODB_HOST, database=MONGODB_DB)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DevelopmentConfig")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开发环境mongeDB地址")]),s._v("\n    MONGODB_HOST "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost:27017'")]),s._v("\n    MONGODB_USERNAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v("\n    MONGODB_PASSWORD "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password123'")]),s._v("\n    MONGODB_DB "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),s._v("\n    COLLECTION_NAME "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'demoScrapy'")]),s._v("\n    MONGO_URI "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mongodb://{server}/{database}"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" \\\n        "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MONGODB_USERNAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MONGODB_PASSWORD"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" server"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MONGODB_HOST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" database"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MONGODB_DB"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\nCONFIG "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'local'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" LocalConfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DevelopmentConfig"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nENV "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'local'")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set settings whose default value is deprecated to a future-proof value")]),s._v("\nREQUEST_FINGERPRINTER_IMPLEMENTATION "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2.7"')]),s._v("\nTWISTED_REACTOR "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"twisted.internet.asyncioreactor.AsyncioSelectorReactor"')]),s._v("\nFEED_EXPORT_ENCODING "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf-8"')]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br"),t("span",{staticClass:"line-number"},[s._v("112")]),t("br"),t("span",{staticClass:"line-number"},[s._v("113")]),t("br"),t("span",{staticClass:"line-number"},[s._v("114")]),t("br"),t("span",{staticClass:"line-number"},[s._v("115")]),t("br"),t("span",{staticClass:"line-number"},[s._v("116")]),t("br"),t("span",{staticClass:"line-number"},[s._v("117")]),t("br"),t("span",{staticClass:"line-number"},[s._v("118")]),t("br"),t("span",{staticClass:"line-number"},[s._v("119")]),t("br"),t("span",{staticClass:"line-number"},[s._v("120")]),t("br"),t("span",{staticClass:"line-number"},[s._v("121")]),t("br"),t("span",{staticClass:"line-number"},[s._v("122")]),t("br"),t("span",{staticClass:"line-number"},[s._v("123")]),t("br"),t("span",{staticClass:"line-number"},[s._v("124")]),t("br"),t("span",{staticClass:"line-number"},[s._v("125")]),t("br"),t("span",{staticClass:"line-number"},[s._v("126")]),t("br"),t("span",{staticClass:"line-number"},[s._v("127")]),t("br"),t("span",{staticClass:"line-number"},[s._v("128")]),t("br"),t("span",{staticClass:"line-number"},[s._v("129")]),t("br"),t("span",{staticClass:"line-number"},[s._v("130")]),t("br")])]),t("p",[s._v("控制台scrapy crawl demoSpider即可将数据保存到mongoDB")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230306222040270.png",alt:"image-20230306222040270"}})]),s._v(" "),t("h3",{attrs:{id:"部署定时爬虫"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署定时爬虫"}},[s._v("#")]),s._v(" 部署定时爬虫")])])}),[],!1,null,null,null);t.default=e.exports}}]);