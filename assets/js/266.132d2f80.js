(window.webpackJsonp=window.webpackJsonp||[]).push([[266],{592:function(a,t,p){"use strict";p.r(t);var r=p(4),s=Object(r.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[a._v("这个文章衍生于一个项目的需求，需要获得fb的一些数据，记录下来免得忘了。")]),a._v(" "),t("h2",{attrs:{id:"思路"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#思路"}},[a._v("#")]),a._v(" 思路")]),a._v(" "),t("p",[a._v("​\t我们知道，FB官方提供了各种数据接口，但是需要token才能请求数据。如果申请成为meta的开发者，也可以有token，但是什么敏感点的数据比如用户email，搜索内容，post文本等等都不能访问，基本上这个token什么也干不了。但是对于FB的APP而言，如果我们登录了fb的app，他内部会产生一个token，这个token权限是非常高的，基本都能访问，并且好像不会过期，但也有一定的数据上限（还没测出来）。")]),a._v(" "),t("p",[a._v("​\t一般来说，获取APP的token有两种办法，一种是直接替换fb里面的io文件，把发送数据包时失败的代码改成成功的代码，可惜我试了没成功。另一种是使用挂钩子的办法，在登录的时候插入一段代码，改变其中的一些函数，进而获取到token。"),t("strong",[a._v("本文使用frida来获取token。")])]),a._v(" "),t("h2",{attrs:{id:"具体流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#具体流程"}},[a._v("#")]),a._v(" 具体流程")]),a._v(" "),t("h3",{attrs:{id:"环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[a._v("#")]),a._v(" 环境准备：")]),a._v(" "),t("blockquote",[t("p",[a._v("frida 15.2.2（建议在conda里创一个虚拟环境）以及对应server版本")]),a._v(" "),t("p",[a._v("夜神模拟器 v7.0.3.2(国际版好点，不然很多广告)")]),a._v(" "),t("p",[a._v("facebook APP v373.0.0.31.112-314614979_minAPI23(x86)(nodpi).apk")]),a._v(" "),t("p",[a._v("burp suitePro-2021.12.10")]),a._v(" "),t("p",[a._v("clash(提供外网代理，ssr也可以，但设置起来更麻烦，推荐clash)")]),a._v(" "),t("p",[a._v("SSL_Pinning_Bypass 脚本 ：")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/Eltion/Facebook-SSL-Pinning-Bypass",target:"_blank",rel:"noopener noreferrer"}},[a._v("FBAPP以及SSL脚本"),t("OutboundLink")],1)])]),a._v(" "),t("h3",{attrs:{id:"clash配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#clash配置"}},[a._v("#")]),a._v(" Clash配置")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202225329618.png",alt:"image-20230202225329618"}})]),a._v(" "),t("h3",{attrs:{id:"burp设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#burp设置"}},[a._v("#")]),a._v(" Burp设置")]),a._v(" "),t("ol",[t("li",[a._v("打开burp，默认就是新建项目，然后点击下一步。")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202211132350.png",alt:"image-20230202211132350"}})]),a._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[a._v("选择默认值即可"),t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202211540061.png",alt:"image-20230202211540061"}})])]),a._v(" "),t("li",[t("p",[a._v("设置监听端口")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("依照顺序打开"),t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202212440852.png",alt:"image-20230202212440852"}})]),a._v(" "),t("p",[a._v("2.设置绑定端口为8888（也可以是其他的，但是后面模拟器的也要一致）"),t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202212355775.png",alt:"image-20230202212355775"}})])])])]),a._v(" "),t("li",[t("p",[a._v("上游代理设置")]),a._v(" "),t("p",[a._v("因为我们需要监听的数据是需要通过代理软件再转发的，即app数据包->burp->clash->服务器所以要对burp也设置代理")]),a._v(" "),t("ol",[t("li",[a._v("在user option中设置，如果所监听的数据不需要翻墙，就不用设置")])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202225759820.png",alt:"image-20230202225759820"}})]),a._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[a._v("设置代理，*是所有的意思，7890是clash的代理端口")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202225931779.png",alt:"image-20230202225931779"}})])])])])]),a._v(" "),t("h3",{attrs:{id:"配置夜神模拟器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置夜神模拟器"}},[a._v("#")]),a._v(" 配置夜神模拟器")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("设置root权限")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202193700841.png",alt:"image-20230202193700841"}})])]),a._v(" "),t("li",[t("p",[a._v("设置模拟器代理")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("查看当前所用网络的ip地址，打开命令提示符，输入ipconfig，找到ipv4地址"),t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202195648253.png",alt:"image-20230202195648253"}})])]),a._v(" "),t("li",[t("p",[a._v("配置代理")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("拖拽facebook的安装包到模拟器中即可安装")])]),a._v(" "),t("li",[t("p",[a._v("长按WLAN，点击修改网络")])])]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202195701158.png",alt:"image-20230202195701158"}})]),a._v(" "),t("p",[a._v("​\t\t3. 设置手机代理为burp监听的端口号")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202195726157.png",alt:"image-20230202195726157"}})]),a._v(" "),t("ol",[t("li",[t("p",[a._v("设置夜神模拟器安装路径的bin目录设置为环境变量的path")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("打开安装文件位置"),t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202195733473.png",alt:"image-20230202195733473"}})])]),a._v(" "),t("li",[t("p",[a._v("复制路径"),t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202200554339.png",alt:"image-20230202200554339"}})])]),a._v(" "),t("li",[t("p",[a._v("设置环境变量")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("搜索env，回车，然后设置系统变量Path"),t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202200111566.png",alt:"image-20230202200111566"}})])]),a._v(" "),t("li",[t("p",[a._v("新建粘贴刚刚复制的路径"),t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202200529829.png",alt:"image-20230202200529829"}})])]),a._v(" "),t("li",[t("p",[a._v("打开cmd 输入adb devices，回车验证是否成功添加到环境变量")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202233148006.png",alt:"image-20230202233148006"}})])])])])])])])])])])]),a._v(" "),t("h3",{attrs:{id:"frida配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#frida配置"}},[a._v("#")]),a._v(" frida配置")]),a._v(" "),t("p",[a._v("​\t1.首先在PC端，打开anconda prompt，创建一个虚拟环境，安装conda，再安装frida，可以pip安装，frida --version显示版本号即为安装成功")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202230133124.png",alt:"image-20230202230133124"}})]),a._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[a._v("然后在手机端安装server")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("打开cmd，复制server文件所在文件夹")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202230316622.png",alt:"image-20230202230316622"}})])]),a._v(" "),t("li",[t("p",[a._v("将该server文件推入adb中"),t("code",[a._v("adb push frida-server-15.2.2-android-x86 /data/local/tmp/")])])]),a._v(" "),t("li",[t("p",[a._v("设置执行权限，并执行,输入一下命令")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /data/local/tmp\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("777")]),a._v(" frida-server-15.2.2-android-x86\n./frida-server-15.2.2-android-x86 "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])])]),a._v(" "),t("li",[t("p",[a._v("上面的过程如下")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202230549863.png",alt:"image-20230202230549863"}})])]),a._v(" "),t("li",[t("p",[a._v("电脑打开anconda  prompt，激活frida环境，输入"),t("code",[a._v("frida-ps -U")]),a._v("显示出adb中的进程即为成功")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202230702957.png",alt:"image-20230202230702957"}})])])])]),a._v(" "),t("li",[t("p",[a._v("执行脚本，注意脚本要放在对应的目录，比如这里的脚本放在了")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202230843422.png",alt:"image-20230202230843422"}})])]),a._v(" "),t("li",[t("p",[a._v("这个脚本会自动打开模拟器中的facebook，我们输入账号密码登录，这时注意burp会默认拦截请求，切换回burp，要让其通过。然后会收到验证码，输入验证码登录，继续切换回burp，放行数据包。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202231022906.png",alt:"image-20230202231022906"}})])]),a._v(" "),t("li",[t("p",[a._v("然后就可以成功抓到数据包了。FB查询数据使用的是其自己开发的graphsql，其中带有token。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202231254082.png",alt:"image-20230202231254082"}})])]),a._v(" "),t("li",[t("p",[a._v("Qauth即所需token")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230202231423144.png",alt:"image-20230202231423144"}})])])])])}),[],!1,null,null,null);t.default=s.exports}}]);