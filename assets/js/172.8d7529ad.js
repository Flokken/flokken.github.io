(window.webpackJsonp=window.webpackJsonp||[]).push([[172],{499:function(a,s,t){"use strict";t.r(s);var e=t(4),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("blockquote",[s("p",[a._v("教程来自由于黑马微服务")])]),a._v(" "),s("h1",{attrs:{id:"_1-单机部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-单机部署"}},[a._v("#")]),a._v(" 1.单机部署")]),a._v(" "),s("p",[a._v("我们在Centos7虚拟机中使用Docker来安装。")]),a._v(" "),s("h2",{attrs:{id:"_1-1-下载镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-下载镜像"}},[a._v("#")]),a._v(" 1.1.下载镜像")]),a._v(" "),s("p",[a._v("方式一：在线拉取")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" pull rabbitmq:3-management\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("方式二：从本地加载")]),a._v(" "),s("p",[a._v("在课前资料已经提供了镜像包：")]),a._v(" "),s("p",[a._v("上传到虚拟机中后，使用命令加载镜像即可：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" load "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" mq.tar\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"_1-2-安装mq"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-安装mq"}},[a._v("#")]),a._v(" 1.2.安装MQ")]),a._v(" "),s("p",[a._v("执行下面的命令来运行MQ容器：")]),a._v(" "),s("div",{staticClass:"language-sh line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" run "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("RABBITMQ_DEFAULT_USER")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("itcast "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("RABBITMQ_DEFAULT_PASS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("123321")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" mq "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--hostname")]),a._v(" mq1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("15672")]),a._v(":15672 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5672")]),a._v(":5672 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n rabbitmq:3-management\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("h1",{attrs:{id:"_2-集群部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-集群部署"}},[a._v("#")]),a._v(" 2.集群部署")]),a._v(" "),s("p",[a._v("接下来，我们看看如何安装RabbitMQ的集群。")]),a._v(" "),s("h2",{attrs:{id:"_2-1-集群分类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-集群分类"}},[a._v("#")]),a._v(" 2.1.集群分类")]),a._v(" "),s("p",[a._v("在RabbitMQ的官方文档中，讲述了两种集群的配置方式：")]),a._v(" "),s("ul",[s("li",[a._v("普通模式：普通模式集群不进行数据同步，每个MQ都有自己的队列、数据信息（其它元数据信息如交换机等会同步）。例如我们有2个MQ：mq1，和mq2，如果你的消息在mq1，而你连接到了mq2，那么mq2会去mq1拉取消息，然后返回给你。如果mq1宕机，消息就会丢失。")]),a._v(" "),s("li",[a._v("镜像模式：与普通模式不同，队列会在各个mq的镜像节点之间同步，因此你连接到任何一个镜像节点，均可获取到消息。而且如果一个节点宕机，并不会导致数据丢失。不过，这种方式增加了数据同步的带宽消耗。")])]),a._v(" "),s("p",[a._v("我们先来看普通模式集群。")]),a._v(" "),s("h2",{attrs:{id:"_2-2-设置网络"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-设置网络"}},[a._v("#")]),a._v(" 2.2.设置网络")]),a._v(" "),s("p",[a._v("首先，我们需要让3台MQ互相知道对方的存在。")]),a._v(" "),s("p",[a._v("分别在3台机器中，设置 /etc/hosts文件，添加如下内容：")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("192.168.150.101 mq1\n192.168.150.102 mq2\n192.168.150.103 mq3\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("并在每台机器上测试，是否可以ping通对方：")])])}),[],!1,null,null,null);s.default=r.exports}}]);