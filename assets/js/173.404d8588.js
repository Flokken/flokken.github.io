(window.webpackJsonp=window.webpackJsonp||[]).push([[173],{501:function(a,s,t){"use strict";t.r(s);var n=t(4),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"微服务介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微服务介绍"}},[a._v("#")]),a._v(" 微服务介绍")]),a._v(" "),s("h3",{attrs:{id:"基础介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础介绍"}},[a._v("#")]),a._v(" 基础介绍")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615112137660.png",alt:"image-20230615112137660"}})]),a._v(" "),s("h4",{attrs:{id:"单体架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#单体架构"}},[a._v("#")]),a._v(" 单体架构")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615112524109.png",alt:"image-20230615112524109"}})]),a._v(" "),s("h4",{attrs:{id:"分布式架构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分布式架构"}},[a._v("#")]),a._v(" 分布式架构")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615112558149.png",alt:"image-20230615112558149"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615160745903.png",alt:"image-20230615160745903"}})]),a._v(" "),s("h4",{attrs:{id:"微服务结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微服务结构"}},[a._v("#")]),a._v(" 微服务结构")]),a._v(" "),s("p",[a._v("一般常用的就是springCloud和阿里巴巴的Dubbo")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615161059031.png",alt:"image-20230615161059031"}})]),a._v(" "),s("p",[a._v("企业需求")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615161124880.png",alt:"image-20230615161124880"}})]),a._v(" "),s("h4",{attrs:{id:"springcloud是啥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#springcloud是啥"}},[a._v("#")]),a._v(" SpringCloud是啥？")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615161425757.png",alt:"image-20230615161425757"}})]),a._v(" "),s("p",[a._v("springCloud可以和springboot兼容，但需要注意版本的对应关系")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615161748282.png",alt:"image-20230615161748282"}})]),a._v(" "),s("h3",{attrs:{id:"服务拆分和远程调用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务拆分和远程调用"}},[a._v("#")]),a._v(" 服务拆分和远程调用")]),a._v(" "),s("p",[s("strong",[a._v("微服务拆分注意事项")])]),a._v(" "),s("p",[a._v("1.微服务需要根据业务模块拆分，做到单一职责,不要重复开发相同业务")]),a._v(" "),s("p",[a._v("2.微服务可以将业务暴露为接口，供其它微服务使用")]),a._v(" "),s("p",[a._v("3.不同微服务都应该有自己独立的数据库")]),a._v(" "),s("h4",{attrs:{id:"远程调用案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#远程调用案例"}},[a._v("#")]),a._v(" 远程调用案例")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615162531577.png",alt:"image-20230615162531577"}})]),a._v(" "),s("blockquote",[s("p",[a._v("也就是说，现在的查询需求，需要从两个数据库里查不同的信息，最后拼接成一个返回")]),a._v(" "),s("p",[s("strong",[a._v("并且，userService（8081）和orderService（8080）写在了两个不同的项目，连接的数据库是不一样的")])])]),a._v(" "),s("p",[a._v("这里我们想**，如果让订单模块去访问用户模块的接口，然后把得到的信息加上自己本身查到的订单信息**，不就完成了需求嘛，如下图")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615163211152.png",alt:"image-20230615163211152"}})]),a._v(" "),s("h5",{attrs:{id:"实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[a._v("#")]),a._v(" 实现")]),a._v(" "),s("p",[a._v("使用RestTemplate可以实现远程调用")]),a._v(" "),s("blockquote",[s("p",[a._v("其实跨服务器远程调用就是在方法里发http请求")])]),a._v(" "),s("p",[a._v("首先注册RestTemplate")]),a._v(" "),s("p",[a._v("在order-service的OrderApplication中注册RestTemplate")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@MapperScan")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"cn.itcast.order.mapper"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@SpringBootApplication")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OrderApplication")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("SpringApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OrderApplication")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * 创建RestTemplate并注入Spring容器\n     */")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Bean")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@LoadBalanced")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RestTemplate")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("restTemplate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RestTemplate")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br")])]),s("p",[a._v("修改order-service中的OrderService的queryOrderById方法：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Autowired")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RestTemplate")]),a._v(" restTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Order")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("queryOrderById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Long")]),a._v(" orderId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 1.查询订单")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Order")]),a._v(" order "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" orderMapper"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("findById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("orderId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 2.利用RestTemplate发起http请求，查询用户")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 2.1.url路径")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" url "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"http://userservice/user/"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getUserId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 2.2.发送http请求，实现远程调用")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),a._v(" user "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" restTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("getForObject")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("url"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("User")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 3.封装user到Order")]),a._v("\n    order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("setUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 4.返回")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" order"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br")])]),s("h5",{attrs:{id:"分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分析"}},[a._v("#")]),a._v(" 分析")]),a._v(" "),s("p",[a._v("服务提供者：一次业务中，被其它微服务调用的服务。（提供接口给其它微服务）")]),a._v(" "),s("p",[a._v("服务消费者：一次业务中，调用其它微服务的服务。（调用其它微服务提供的接口）")]),a._v(" "),s("p",[a._v("Q：服务A调用服务B，服务B调用服务C，那么服务B是什么角色？")]),a._v(" "),s("p",[a._v("A：提供者与消费者角色其实是"),s("strong",[a._v("相对")]),a._v("的，一个服务可以同时是服务提供者和服务消费者")]),a._v(" "),s("h3",{attrs:{id:"eureka注册中心"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eureka注册中心"}},[a._v("#")]),a._v(" Eureka注册中心")]),a._v(" "),s("h4",{attrs:{id:"案例存在问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#案例存在问题"}},[a._v("#")]),a._v(" 案例存在问题")]),a._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615164247059.png"}}),a._v(" "),s("p",[a._v("比如我们请求的时候，是硬编码的，很不方便改（当然，这只是一个原因，属于地址信息不好获取和更改）")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615164724544.png",alt:"image-20230615164724544"}})]),a._v(" "),s("h4",{attrs:{id:"eureka作用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eureka作用"}},[a._v("#")]),a._v(" Eureka作用")]),a._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615173235552.png"}}),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615173404241.png",alt:"image-20230615173404241"}})]),a._v(" "),s("p",[a._v("在Eureka架构中，微服务角色有两类：")]),a._v(" "),s("p",[a._v("EurekaServer：服务端，注册中心")]),a._v(" "),s("ul",[s("li",[a._v("记录服务信息")]),a._v(" "),s("li",[a._v("心跳监控")])]),a._v(" "),s("p",[a._v("EurekaClient：客户端")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("Provider：服务提供者，例如案例中的 user-service")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("注册自己的信息到EurekaServer")])]),a._v(" "),s("li",[s("p",[a._v("每隔30秒向EurekaServer发送心跳")])])])]),a._v(" "),s("li",[s("p",[a._v("consumer：服务消费者，例如案例中的 order-service")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("根据服务名称从EurekaServer拉取服务列表")])]),a._v(" "),s("li",[s("p",[a._v("基于服务列表做负载均衡，选中一个微服务后发起远程调用")])])])])]),a._v(" "),s("h4",{attrs:{id:"实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实践"}},[a._v("#")]),a._v(" 实践")]),a._v(" "),s("h5",{attrs:{id:"服务端服务注册"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务端服务注册"}},[a._v("#")]),a._v(" 服务端服务注册")]),a._v(" "),s("p",[a._v("eureka自己就是一个微服务，因此需要自己跑一个server")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.springframework.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-netflix-eureka-server"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("在启动类，添加@EnableEurekaServer注解(只有server才开这个注解)")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615212301349.png",alt:"image-20230615212301349"}})]),a._v(" "),s("p",[a._v("然后application.yml中加上")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10086")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 服务端口")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" eurekaserver "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# eureka的服务名称")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# eureka的地址信息")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("10086/eureka\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br")])]),s("h5",{attrs:{id:"客户端服务注册"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#客户端服务注册"}},[a._v("#")]),a._v(" 客户端服务注册")]),a._v(" "),s("p",[a._v("在user和order的微服务中注册eureka")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.springframework.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-netflix-eureka-client"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("然后加配置")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\t    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" orderservice\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# eureka的地址信息")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("10086/eureka\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("application")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\t    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" userservice\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("eureka")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("client")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("service-url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# eureka的地址信息")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("defaultZone")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" http"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//127.0.0.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("10086/eureka\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("h6",{attrs:{id:"服务启动多个实例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务启动多个实例"}},[a._v("#")]),a._v(" "),s("strong",[a._v("服务启动多个实例")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615213900068.png",alt:"image-20230615213900068"}})]),a._v(" "),s("p",[a._v("上面这个是老版本的，新版本这样")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230620112048293.png",alt:"image-20230620112048293"}})]),a._v(" "),s("p",[a._v("就只是改了一个端口号，然后可以同时运行两个服务了")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230620112113504.png",alt:"image-20230620112113504"}})]),a._v(" "),s("p",[a._v("总结，只要是在引依赖加配置，就是在做服务注册")]),a._v(" "),s("h5",{attrs:{id:"idea管理多个微服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#idea管理多个微服务"}},[a._v("#")]),a._v(" idea管理多个微服务")]),a._v(" "),s("p",[a._v("如果没有添加spring boot类型服务，要先添加，然后启动的spring boot服务下面都能看到")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230618163712521.png",alt:"image-20230618163712521"}})]),a._v(" "),s("h5",{attrs:{id:"服务发现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务发现"}},[a._v("#")]),a._v(" 服务发现")]),a._v(" "),s("p",[a._v("也很简单，也就是把硬地址换成服务名(就是微服务的名字，比如orderservice和userservice)，然后eureka会自动分配请求和负载均衡")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615213755444.png",alt:"image-20230615213755444"}})]),a._v(" "),s("blockquote",[s("p",[s("strong",[a._v("这里把userservice启动了两次，，在不同端口，模拟多实例")])])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615212924064.png",alt:"image-20230615212924064"}})]),a._v(" "),s("blockquote",[s("p",[a._v("测试发现，对于两次userservice请求，一次给了8081的服务，一次给了8082的服务，也就是轮询均载方式")])]),a._v(" "),s("h4",{attrs:{id:"ribbon负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ribbon负载均衡"}},[a._v("#")]),a._v(" Ribbon负载均衡")]),a._v(" "),s("p",[a._v("上面我们更改了url为服务名，背后做了什么？")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615214202618.png",alt:"image-20230615214202618"}})]),a._v(" "),s("p",[s("code",[a._v("ctrl+shift+N")]),a._v("调出对已经导入类，文件等的搜索，"),s("strong",[a._v("输入LoadBalancerInterceptor")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615214752598.png",alt:"image-20230615214752598"}})]),a._v(" "),s("p",[a._v("接下来开始读源码，发现他实现了http拦截器")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615215131603.png",alt:"image-20230615215131603"}})]),a._v(" "),s("p",[a._v("然后看这个方法，发现这个得到了主机名，那么肯定之后要找eureka拿地址")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615215358702.png",alt:"image-20230615215358702"}})]),a._v(" "),s("p",[a._v("通过断点调试，可以来到这个方法，发现这里得到了server地址，然后就可以做负载均衡了")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615215540886.png",alt:"image-20230615215540886"}})]),a._v(" "),s("p",[a._v("继续往下发现后面实现了一些负载均衡算法（IRule接口），然后返回一个算法给出的地址，之后只需要把userservice替换为得到的地址即可")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615215747400.png",alt:"image-20230615215747400"}})]),a._v(" "),s("h5",{attrs:{id:"负载均衡策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡策略"}},[a._v("#")]),a._v(" "),s("strong",[a._v("负载均衡策略")])]),a._v(" "),s("blockquote",[s("p",[a._v("Ribbon的负载均衡规则是一个叫做IRule的接口来定义的，每一个子接口都是一种规则：")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615215944390.png",alt:"image-20230615215944390"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615220025630.png",alt:"image-20230615220025630"}})]),a._v(" "),s("h5",{attrs:{id:"更改规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更改规则"}},[a._v("#")]),a._v(" 更改规则")]),a._v(" "),s("p",[a._v("通过定义IRule实现可以修改负载均衡规则，有两种方式：")]),a._v(" "),s("p",[a._v("1.代码方式：在order-service中的OrderApplication类中，定义一个新的IRule：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Bean")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("IRule")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("randomRule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RandomRule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("2.配置文件方式：在order-service的application.yml文件中，添加新的配置也可以修改规则：")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("userservice")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ribbon")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    \t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("NFLoadBalancerRuleClassName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" com.netflix.loadbalancer.RandomRule"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 负载均衡规则 ")]),a._v("\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h5",{attrs:{id:"饥饿加载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#饥饿加载"}},[a._v("#")]),a._v(" 饥饿加载")]),a._v(" "),s("p",[a._v("Ribbon默认是采用懒加载，即第一次访问时才会去创建LoadBalanceClient，请求时间会很长。")]),a._v(" "),s("p",[a._v("而饥饿加载则会在项目启动时创建，降低第一次访问的耗时，通过下面配置开启饥饿加载：")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ribbon")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("eager-load")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 开启饥饿加载 ")]),a._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("clients")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" userservice "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定对userservice这个服务饥饿加载")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"nacos注册中心"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos注册中心"}},[a._v("#")]),a._v(" Nacos注册中心")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://nacos.io/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Nacos"),s("OutboundLink")],1),a._v("是阿里巴巴的产品，"),s("strong",[a._v("现在是"),s("a",{attrs:{href:"https://spring.io/projects/spring-cloud",target:"_blank",rel:"noopener noreferrer"}},[a._v("SpringCloud"),s("OutboundLink")],1),a._v("中的一个组件")]),a._v("。相比"),s("a",{attrs:{href:"https://github.com/Netflix/eureka",target:"_blank",rel:"noopener noreferrer"}},[a._v("Eureka"),s("OutboundLink")],1),a._v("功能更加丰富，在国内受欢迎程度较高。")]),a._v(" "),s("p",[a._v("服务注册到Nacos")]),a._v(" "),s("p",[a._v("还是用的之前的案例，这里给出最终的目录结构")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615221830276.png",alt:"image-20230615221830276"}})]),a._v(" "),s("p",[a._v("1.在cloud-demo父工程中添加spring-cloud-alilbaba的管理依赖：")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("\x3c!--nacos的管理依赖--\x3e")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alibaba.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-alibaba-dependencies"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("2.2.5.RELEASE"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("pom"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("scope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("import"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("scope")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("p",[a._v("2.注释掉order-service和user-service中原有的eureka依赖。")]),a._v(" "),s("p",[a._v("3.添加nacos的客户端依赖(userservice和orderservice里加)：")]),a._v(" "),s("div",{staticClass:"language-xml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("\x3c!-- nacos客户端依赖包 --\x3e")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("com.alibaba.cloud"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("spring-cloud-starter-alibaba-nacos-discovery"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br")])]),s("p",[a._v("4.**修改user-service&order-service中（因为他们是两个微服务）**的application.yml文件，注释eureka地址，添加nacos地址")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[a._v("spring\n\t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    \t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n\t      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nacos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# nacos服务地址")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("5.启动并测试")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615222355358.png",alt:"image-20230615222355358"}}),a._v("、")]),a._v(" "),s("h4",{attrs:{id:"nacos分级存储模型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos分级存储模型"}},[a._v("#")]),a._v(" nacos分级存储模型")]),a._v(" "),s("p",[a._v("根据不同地域的计算机划分集群")]),a._v(" "),s("blockquote",[s("p",[a._v("因为这样可以让请求尽量访问本地集群，加快速度")]),a._v(" "),s("p",[a._v("跨集群问题：")]),a._v(" "),s("p",[a._v("服务调用尽可能选择本地集群的服务，跨集群调用延迟较高")]),a._v(" "),s("p",[a._v("本地集群不可访问时，再去访问其它集群")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615222444321.png",alt:"image-20230615222444321"}})]),a._v(" "),s("h4",{attrs:{id:"配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[a._v("#")]),a._v(" 配置")]),a._v(" "),s("p",[a._v("直接设置服务属性，就可以让他属于不同集群")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spring")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cloud")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("nacos")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("server-addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nacos"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8848")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# nacos服务地址")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("discovery")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      \t"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("cluster-name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" HZ\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("p",[a._v("设置服务的属性不同名字，模拟不同地域集群")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230615223003994.png",alt:"image-20230615223003994"}})]),a._v(" "),s("p",[s("strong",[a._v("实现优先访问本地集群，只需要改变rule即可")])]),a._v(" "),s("p",[a._v("假设order-service为HZ集群，user-service为SH集群")]),a._v(" "),s("p",[a._v("在order-service中设置负载均衡的IRule为NacosRule，这个规则优先会寻找与自己同集群的服务（"),s("strong",[a._v("给他启动多个实例，模拟多服务")]),a._v("）：")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("userservice")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ribbon")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("NFLoadBalancerRuleClassName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" com.alibaba.cloud.nacos.ribbon.NacosRule  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 负载均衡规则")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ribbon")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("eager-load")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 开启饥饿加载")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("clients")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 指定饥饿加载的服务名称")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" userservice\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br")])]),s("h4",{attrs:{id:"根据权重负载均衡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#根据权重负载均衡"}},[a._v("#")]),a._v(" 根据权重负载均衡")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230618162805920.png",alt:"image-20230618162805920"}})]),a._v(" "),s("h4",{attrs:{id:"环境隔离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境隔离"}},[a._v("#")]),a._v(" 环境隔离")]),a._v(" "),s("p",[a._v("Nacos中服务存储和数据存储的最外层都是一"),s("strong",[a._v("个名为namespace的东西，用来做最外层隔离")])]),a._v(" "),s("blockquote",[s("p",[a._v("比如开发环境，生成环境的变化，可以用namespace来实现")])]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230618164236664.png",alt:"image-20230618164236664"}})]),a._v(" "),s("h5",{attrs:{id:"操作配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#操作配置"}},[a._v("#")]),a._v(" 操作配置")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230618164322461.png",alt:"image-20230618164322461"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230618164332573.png",alt:"image-20230618164332573"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230618164417839.png",alt:"image-20230618164417839"}})]),a._v(" "),s("p",[a._v("上面创建了一个dev的命名空间，把他加到orderService的配置文件里使得他生效")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230618164512458.png",alt:"image-20230618164512458"}})]),a._v(" "),s("p",[a._v("重新运行服雾即可看到其生效（此时不能再访问orderService，因为不同namespace下的数据互相不可见）")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230618164650365.png",alt:"image-20230618164650365"}})]),a._v(" "),s("h4",{attrs:{id:"nacos总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nacos总结"}},[a._v("#")]),a._v(" nacos总结")]),a._v(" "),s("img",{staticStyle:{zoom:"90%"},attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230618164926679.png"}}),a._v(" "),s("h5",{attrs:{id:"对比eureka"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对比eureka"}},[a._v("#")]),a._v(" 对比Eureka")]),a._v(" "),s("p",[a._v("1.Nacos与eureka的共同点")]),a._v(" "),s("p",[a._v("​\t①都支持服务注册和服务拉取")]),a._v(" "),s("p",[a._v("​\t②都支持服务提供者心跳方式做健康检测")]),a._v(" "),s("p",[a._v("2.Nacos与Eureka的区别")]),a._v(" "),s("p",[a._v("​\t①Nacos支持服务端主动检测提供者状态："),s("strong",[a._v("临时实例采用心跳模式，非临时实例采用主动检测模式")])]),a._v(" "),s("p",[a._v("​\t②临时实例心跳不正常会被剔除，非临时实例则不会被剔除")]),a._v(" "),s("p",[a._v("​\t③"),s("strong",[a._v("Nacos支持服务列表变更的消息推送模式，服务列表更新更及时（Eureka不支持）")])]),a._v(" "),s("p",[a._v("​\t④Nacos集群默认采用AP方式，当集群中存在非临时实例时，采用CP模式；Eureka采用AP方式")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230618165045779.png",alt:"image-20230618165045779"}})]),a._v(" "),s("blockquote",[s("p",[s("strong",[a._v("可以把服务关了，来模拟宕机")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);