---
title: 认识分布式系统
date: 2023-05-19
tags: 
  - 深入理解分布式系统 
categories: 
  - 大数据
  - 深入理解分布式系统
---

## 分布式系统定义

分布式系统是其组件分布在不同的，联网的计算机上，组件之间通过传递消息进行通信和协调，共同完成一个任务的系统。实际上，分布式系统就是研究如何协调这些联网的计算机共同完成任务。

### 特点

- 多进程，分布式系统中有多个进程并发运行
- 不共享操作系统，通过网络通信传递消息来协作
- 不共享时钟，所以很难通过时钟定义两个事件顺序

### 为什么需要分布式系统

- 高性能
  - 单个CPU的性能是有限的，并且随着芯片设计的进步，摩尔定律已经失效，现代的CPU将CPU装载更多的核来提高性能，这样仍然有极限并且成本高，因此可以选择将大量的廉价计算机联合起来，组成一个有大量CPU、内存和磁盘的分布式系统，**这样做同样可以实现高性能。**
- 可拓展性
  - 很多应用都是数据密集（data-intensive）型，随着业务拓展、用户增长或者历史数据累积，单台计算机只能拓展到有限程度，而分布式系统集群可以加入新机器，拓展集群规模来满足需求
- 高可用性
  - 在当今，很多在线服务需要7x24小时不间断运行。比如要求99.999%的可用性，即99.999%的时间服务正常运行，意味着每年最多宕机五分钟。单机系统显然不可能达到这种要求，分布式系统可以通过冗余多份数据来保证数据可用性，或者通过冗余计算实现服务切换。

### 分布式系统示例

#### 搜索引擎

经典面试题：“当你在浏览器中输入一个URL并回车，会发生什么”？

> 参考：
>
>  https://zhuanlan.zhihu.com/p/80551769
>
> http://www.dailichun.com/2018/03/12/whenyouenteraurl.html

改一下->当你在Google上搜索某个关键词时，会有哪些分布式系统来处理？

首先，访问一个域名时，要先去DNS中查找对应的IP地址，DNS就是一个将域名和IP地址相互映射的分布式数据库。其特点是去中心化，可扩展性和健壮性，所以DNS可以很好处理负载和故障。

##### Google分布式基础设施

- 一个全球化、巨大的多数据中心
- 一个分布式文件系统 GFS（google file system）
- 一个高性能，可拓展，存储大规模结构化数据的存储系统：Bigtable，就像NoSQL一样，优势在于扩展性和查询性能
- 一个分布式锁服务：Chubby
- 一个并行和分布式计算的编程模式：MapReduce
- 分布式数据库:Spanner

.....

#### 加密货币

基于区块链的分布式共识研究，从分布式系统角度看，比特币贡献了一种实用的，去中心化的和拜占庭容错的共识算法。

### 分布式系统挑战

> 这里记几个常见的

分布式系统常常伴随一些棘手的问题，有一些常见问题

- 网络是不可靠的
  - 因为分布式系统中
- 延迟肯定不是0
- 部分失效问题
- 时钟问题

#### 网络延迟

包括网络可靠性与延迟

例如，分布式系统中可能产生的问题有：

- 消息丢失
- 网络重传消息，导致收到重复的消息
- 消息延迟可能会让我们认为某个服务已经因为故障下线，但实际上没有
- 消息可能以不同顺序到达，或者不同节点上消息到达顺序不同

#### 部分失效问题

在分布式系统中，系统有可能一部分节点正常工作，但由于网络终端，另一部分节点停止运行。这称为部分失效（partial failure），难点在于部分失效是不确定的，如果你试图做涉及多个节点的事情，他有时可能会出现不可预知的失败。而且会带来很大问题，比如要求操作具有原子性

#### 时钟问题

在单机系统中，每个进程共有同一个时间。但是分布式系统中，每台机器有自己的时钟，并且各个物理设备的物理时钟可能不完全一样。另外，消息通过从一台机器传送到另一台机器也需要时间，但由于网络中的可变延迟，我们不知道消息传递花了多少时间。**这会让我们很难确定涉及多台机器时事件发生顺序**

常见的处理方式有使用一个时间服务器来同步时间，但仍不足以解决网络可变延迟问题，更普遍的是使用逻辑时钟来确定时间顺序，并引出分布式系统中状态机的概念。

### 一些常见数字

(2020年)

| 操作                              | 延迟           |
| --------------------------------- | -------------- |
| 执行一个指令                      | 1ns            |
| L1缓存查询                        | 0.5ns          |
| 分支预测错误（Branch Mispredict） | 3ns            |
| L2 缓存查询                       | 4ns            |
| 互斥锁/解锁（Mutex Lock/Unlock）  | 17ns           |
| 主存访问                          | 100ns          |
| 使用zippy算法压缩1KB数据          | 2000ns         |
| 从内存读取1MB数据                 | 3000ns         |
| SSD随机读                         | 39000ns        |
| 从SSD顺序读取1MB数据              | 49000ns        |
| 同一个数据中心往返                | 500000ns       |
| 从磁盘顺序读取1MB数据             | 718000ns       |
| 磁盘寻址                          | 2000000ns(2ms) |
| 数据包往返欧洲与美国              | 150ms          |

了解这些数字有助于设计和比较不同的解决方案。比如从远程服务器的内存读数据快于从硬盘读。

比如设置存储引擎时，很多开源软件如kafka，RocksDB都充分利用**顺序写快于随机读写**，只做追加写而避免随机写来达到最佳读写性能

**延伸**

延迟（Latency），带宽（Bandwidth）和吞吐量（Throughput）之间区别？

用水管举例：**延迟**表示通过管道花费时间，**带宽**表示水管管道宽度，每秒流过的水就是**吞吐量。**

