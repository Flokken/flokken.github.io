---
title: è¡Œä¸ºå‹æ¨¡å¼
date: 2023-01-01
tags: 
  - è®¾è®¡æ¨¡å¼
categories: 
  - å…¶ä»–
  - è®¾è®¡æ¨¡å¼
---

## ç­–ç•¥æ¨¡å¼

ç­–ç•¥æ¨¡å¼æŒ‡çš„æ˜¯å®šä¹‰äº†ä¸€ç³»åˆ—ç®—æ³•ï¼Œå¹¶å°†ä»–ä»¬å°è£…èµ·æ¥ï¼Œä½¿å¾—ä»–ä»¬å¯ä»¥äº’ç›¸æ›¿æ¢ï¼Œä¸”ç®—æ³•çš„å˜åŒ–ä¸ä¼šå½±å“ä½¿ç”¨ç®—æ³•çš„å®¢æˆ·ã€‚ç­–ç•¥æ¨¡å¼å±äºå¯¹è±¡è¡Œä¸ºæ¨¡å¼ï¼Œä»–é€šè¿‡å¯¹ç®—æ³•è¿›è¡Œå°è£…ï¼ŒæŠŠä½¿ç”¨çš„ç®—æ³•çš„è´£ä»»å’Œç®—æ³•çš„å®ç°åˆ†å‰²å¼€ï¼Œå¹¶è®©ä¸åŒçš„å¯¹è±¡å¯¹è¿™äº›ç®—æ³•è¿›è¡Œç®¡ç†ã€‚

> ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºæ¨¡å¼ï¼Œä¹Ÿæ˜¯æ›¿ä»£å¤§é‡`ifelse`çš„åˆ©å™¨ã€‚å®ƒæ‰€èƒ½å¸®ä½ è§£å†³çš„æ˜¯åœºæ™¯ï¼Œä¸€èˆ¬æ˜¯å…·æœ‰åŒç±»å¯æ›¿ä»£çš„è¡Œä¸ºé€»è¾‘ç®—æ³•åœºæ™¯ã€‚æ¯”å¦‚ï¼›ä¸åŒç±»å‹çš„äº¤æ˜“æ–¹å¼(ä¿¡ç”¨å¡ã€æ”¯ä»˜å®ã€å¾®ä¿¡)ã€ç”Ÿæˆå”¯ä¸€IDç­–ç•¥(UUIDã€DBè‡ªå¢ã€DB+Redisã€é›ªèŠ±ç®—æ³•ã€Leafç®—æ³•)ç­‰ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼è¿›è¡Œè¡Œä¸ºåŒ…è£…ï¼Œä¾›ç»™å¤–éƒ¨ä½¿ç”¨ã€‚

### åœºæ™¯æ¨¡æ‹Ÿ

**åœ¨æœ¬æ¡ˆä¾‹ä¸­æˆ‘ä»¬æ¨¡æ‹Ÿåœ¨è´­ä¹°å•†å“æ—¶å€™ä½¿ç”¨çš„å„ç§ç±»å‹ä¼˜æƒ åˆ¸(æ»¡å‡ã€ç›´å‡ã€æŠ˜æ‰£ã€nå…ƒè´­)**

<img src="https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/itstack-demo-design-20-03.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›å•†å“æ”¯ä»˜ä½¿ç”¨è¥é”€ä¼˜æƒ åˆ¸" style="zoom:80%;" />

è¿™ä¸ªåœºæ™¯å‡ ä¹ä¹Ÿæ˜¯å¤§å®¶çš„ä¸€ä¸ªæ—¥å¸¸è´­ç‰©çœé’±æ¸ é“ï¼Œè´­ä¹°å•†å“çš„æ—¶å€™éƒ½å¸Œæœ›æ‰¾ä¸€äº›ä¼˜æƒ åˆ¸ï¼Œè®©è´­ä¹°çš„å•†å“æ›´åŠ å®æƒ ã€‚è€Œä¸”åˆ°äº†å¤§ä¿ƒçš„æ—¶å€™å°±ä¼šæœ‰æ›´å¤šçš„ä¼˜æƒ åˆ¸éœ€è¦è®¡ç®—é‚£äº›å•†å“ä¸€èµ·è´­ä¹°æ›´åŠ ä¼˜æƒ ï¼ï¼ï¼

è¿™æ ·çš„åœºæ™¯æœ‰æ—¶å€™ç”¨æˆ·ç”¨èµ·æ¥è¿˜æ˜¯è›®çˆ½çš„ï¼Œä½†æ˜¯æœ€åˆè¿™æ ·åŠŸèƒ½çš„è®¾å®šä»¥åŠäº§å“çš„ä¸æ–­è¿­ä»£ï¼Œå¯¹äºç¨‹åºå‘˜ğŸ‘¨â€ğŸ’»â€å¼€å‘è¿˜æ˜¯ä¸å¤ªå®¹æ˜“çš„ã€‚**å› ä¸ºè¿™é‡ŒåŒ…æ‹¬äº†å¾ˆå¤šçš„è§„åˆ™å’Œä¼˜æƒ é€»è¾‘ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¨¡æ‹Ÿå…¶ä¸­çš„ä¸€ä¸ªè®¡ç®—ä¼˜æƒ çš„æ–¹å¼ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å®ç°ã€‚**

æˆ‘ä»¬ç”¨ä¼ ç»Ÿçš„é¢å‘è¿‡ç¨‹å¼€å‘

```java
/**
 * åšå®¢ï¼šhttps://bugstack.cn - æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼
 * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ
 * Create by å°å‚…å“¥(fustack) @2020
 * ä¼˜æƒ åˆ¸æŠ˜æ‰£è®¡ç®—æ¥å£
 * <p>
 * ä¼˜æƒ åˆ¸ç±»å‹ï¼›
 * 1. ç›´å‡åˆ¸
 * 2. æ»¡å‡åˆ¸
 * 3. æŠ˜æ‰£åˆ¸
 * 4. nå…ƒè´­
 */
public class CouponDiscountService {

    public double discountAmount(int type, double typeContent, double skuPrice, double typeExt) {
        // 1. ç›´å‡åˆ¸
        if (1 == type) {
            return skuPrice - typeContent;
        }
        // 2. æ»¡å‡åˆ¸
        if (2 == type) {
            if (skuPrice < typeExt) return skuPrice;
            return skuPrice - typeContent;
        }
        // 3. æŠ˜æ‰£åˆ¸
        if (3 == type) {
            return skuPrice * typeContent;
        }
        // 4. nå…ƒè´­
        if (4 == type) {
            return typeContent;
        }
        return 0D;
    }

}

```

- ä»¥ä¸Šæ˜¯ä¸åŒç±»å‹çš„ä¼˜æƒ åˆ¸è®¡ç®—æŠ˜æ‰£åçš„å®é™…é‡‘é¢ã€‚
- å…¥å‚åŒ…æ‹¬ï¼›ä¼˜æƒ åˆ¸ç±»å‹ã€ä¼˜æƒ åˆ¸é‡‘é¢ã€å•†å“é‡‘é¢ï¼Œå› ä¸ºæœ‰äº›ä¼˜æƒ åˆ¸æ˜¯æ»¡å¤šå°‘å‡å°‘å¤šå°‘ï¼Œæ‰€ä»¥å¢åŠ äº†`typeExt`ç±»å‹ã€‚è¿™ä¹Ÿæ˜¯æ–¹æ³•çš„ä¸å¥½æ‰©å±•æ€§é—®é¢˜ã€‚
- æœ€åæ˜¯æ•´ä¸ªçš„æ–¹æ³•ä½“ä¸­å¯¹ä¼˜æƒ åˆ¸æŠµæ‰£é‡‘é¢çš„å®ç°ï¼Œæœ€å¼€å§‹å¯èƒ½æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ä¼˜æƒ åˆ¸ï¼Œåé¢éšç€äº§å“åŠŸèƒ½çš„å¢åŠ ï¼Œä¸æ–­çš„æ‰©å±•`if`è¯­å¥ã€‚å®é™…çš„ä»£ç å¯èƒ½è¦æ¯”è¿™ä¸ªå¤šå¾ˆå¤š

### ç­–ç•¥æ¨¡å¼é‡æ„

å·¥ç¨‹ç»“æ„

```java
itstack-demo-design-20-02
â””â”€â”€ src
    â””â”€â”€ main
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.design
                â”œâ”€â”€ event
                â”‚    â””â”€â”€ MJCouponDiscount.java
                â”‚    â””â”€â”€ NYGCouponDiscount.java
                â”‚    â””â”€â”€ ZJCouponDiscount.java
                â”‚    â””â”€â”€ ZKCouponDiscount.java
                â”œâ”€â”€ Context.java
                â””â”€â”€ ICouponDiscount.java

```

æ•´ä½“ç»“æ„

<img src="https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20240101135830523.png" alt="image-20240101135830523" style="zoom:67%;" />

- æ•´ä½“çš„ç»“æ„æ¨¡å¼å¹¶ä¸å¤æ‚ï¼Œä¸»è¦ä½“ç°çš„ä¸åŒç±»å‹çš„ä¼˜æƒ åˆ¸åœ¨è®¡ç®—ä¼˜æƒ åˆ¸æ–¹å¼çš„ä¸åŒè®¡ç®—ç­–ç•¥ã€‚
- è¿™é‡ŒåŒ…æ‹¬ä¸€ä¸ªæ¥å£ç±»(`ICouponDiscount`)ä»¥åŠå››ç§ä¼˜æƒ åˆ¸ç±»å‹çš„å®ç°æ–¹å¼ã€‚
- æœ€åæä¾›äº†ç­–ç•¥æ¨¡å¼çš„ä¸Šä¸‹æ§åˆ¶ç±»å¤„ç†ï¼Œæ•´ä½“çš„ç­–ç•¥æœåŠ¡ã€‚

**ä¼˜æƒ åˆ¸æ¥å£**

```java
public interface ICouponDiscount<T> {

    /**
     * ä¼˜æƒ åˆ¸é‡‘é¢è®¡ç®—
     * @param couponInfo åˆ¸æŠ˜æ‰£ä¿¡æ¯ï¼›ç›´å‡ã€æ»¡å‡ã€æŠ˜æ‰£ã€Nå…ƒè´­
     * @param skuPrice   skué‡‘é¢
     * @return           ä¼˜æƒ åé‡‘é¢
     */
    BigDecimal discountAmount(T couponInfo, BigDecimal skuPrice);

}

```

- å®šä¹‰äº†ä¼˜æƒ åˆ¸æŠ˜æ‰£æ¥å£ï¼Œä¹Ÿå¢åŠ äº†æ³›å‹ç”¨äºä¸åŒç±»å‹çš„æ¥å£å¯ä»¥ä¼ é€’ä¸åŒçš„ç±»å‹å‚æ•°ã€‚
- æ¥å£ä¸­åŒ…æ‹¬å•†å“é‡‘é¢ä»¥åŠå‡ºå‚è¿”å›æœ€ç»ˆæŠ˜æ‰£åçš„é‡‘é¢ï¼Œè¿™é‡Œåœ¨å®é™…å¼€å‘ä¸­ä¼šæ¯”ç°åœ¨çš„æ¥å£å‚æ•°å¤šä¸€äº›ï¼Œä½†æ ¸å¿ƒé€»è¾‘æ˜¯è¿™äº›ã€‚

####  æ¥å£å®ç°ç±»

æ»¡å‡

```java
public class MJCouponDiscount implements ICouponDiscount<Map<String,String>>  {

    /**
     * æ»¡å‡è®¡ç®—
     * 1. åˆ¤æ–­æ»¡è¶³xå…ƒå-nå…ƒï¼Œå¦åˆ™ä¸å‡
     * 2. æœ€ä½æ”¯ä»˜é‡‘é¢1å…ƒ
     */
    public BigDecimal discountAmount(Map<String,String> couponInfo, BigDecimal skuPrice) {
        String x = couponInfo.get("x");
        String o = couponInfo.get("n");

        // å°äºå•†å“é‡‘é¢æ¡ä»¶çš„ï¼Œç›´æ¥è¿”å›å•†å“åŸä»·
        if (skuPrice.compareTo(new BigDecimal(x)) < 0) return skuPrice;
        // å‡å»ä¼˜æƒ é‡‘é¢åˆ¤æ–­
        BigDecimal discountAmount = skuPrice.subtract(new BigDecimal(o));
        if (discountAmount.compareTo(BigDecimal.ZERO) < 1) return BigDecimal.ONE;

        return discountAmount;
    }
}

```

ç›´å‡

```java
public class ZJCouponDiscount implements ICouponDiscount<Double>  {

    /**
     * ç›´å‡è®¡ç®—
     * 1. ä½¿ç”¨å•†å“ä»·æ ¼å‡å»ä¼˜æƒ ä»·æ ¼
     * 2. æœ€ä½æ”¯ä»˜é‡‘é¢1å…ƒ
     */
    public BigDecimal discountAmount(Double couponInfo, BigDecimal skuPrice) {
        BigDecimal discountAmount = skuPrice.subtract(new BigDecimal(couponInfo));
        if (discountAmount.compareTo(BigDecimal.ZERO) < 1) return BigDecimal.ONE;
        return discountAmount;
    }

}

```

æŠ˜æ‰£

```java
public class ZKCouponDiscount implements ICouponDiscount<Double> {


    /**
     * æŠ˜æ‰£è®¡ç®—
     * 1. ä½¿ç”¨å•†å“ä»·æ ¼ä¹˜ä»¥æŠ˜æ‰£æ¯”ä¾‹ï¼Œä¸ºæœ€åæ”¯ä»˜é‡‘é¢
     * 2. ä¿ç•™ä¸¤ä½å°æ•°
     * 3. æœ€ä½æ”¯ä»˜é‡‘é¢1å…ƒ
     */
    public BigDecimal discountAmount(Double couponInfo, BigDecimal skuPrice) {
        BigDecimal discountAmount = skuPrice.multiply(new BigDecimal(couponInfo)).setScale(2, BigDecimal.ROUND_HALF_UP);
        if (discountAmount.compareTo(BigDecimal.ZERO) < 1) return BigDecimal.ONE;
        return discountAmount;
    }

}

```

Nå…ƒè´­

~~~java
public class NYGCouponDiscount implements ICouponDiscount<Double> {

    /**
     * nå…ƒè´­è´­ä¹°
     * 1. æ— è®ºåŸä»·å¤šå°‘é’±éƒ½å›ºå®šé‡‘é¢è´­ä¹°
     */
    public BigDecimal discountAmount(Double couponInfo, BigDecimal skuPrice) {
        return new BigDecimal(couponInfo);
    }

}

~~~

#### ç­–ç•¥æ§åˆ¶ç±»

```java
public class Context<T> {

    private ICouponDiscount<T> couponDiscount;

    public Context(ICouponDiscount<T> couponDiscount) {
        this.couponDiscount = couponDiscount;
    }

    public BigDecimal discountAmount(T couponInfo, BigDecimal skuPrice) {
        return couponDiscount.discountAmount(couponInfo, skuPrice);
    }

}

```

- ç­–ç•¥æ¨¡å¼çš„æ§åˆ¶ç±»ä¸»è¦æ˜¯å¤–éƒ¨å¯ä»¥ä¼ é€’ä¸åŒçš„ç­–ç•¥å®ç°ï¼Œåœ¨é€šè¿‡ç»Ÿä¸€çš„æ–¹æ³•æ‰§è¡Œä¼˜æƒ ç­–ç•¥è®¡ç®—ã€‚
- å¦å¤–è¿™é‡Œä¹Ÿå¯ä»¥åŒ…è£…æˆmapç»“æ„ï¼Œè®©å¤–éƒ¨åªéœ€è¦å¯¹åº”çš„æ³›å‹ç±»å‹å³å¯ä½¿ç”¨ç›¸åº”çš„æœåŠ¡ã€‚

###  æµ‹è¯•

è¿™é‡Œä»¥æ»¡å‡ä¼˜æƒ ä¸ºä¾‹

```java
@Test
public void test_mj() {
    // æ»¡100å‡10ï¼Œå•†å“100å…ƒ
    Context<Map<String,String>> context = new Context<Map<String,String>>(new MJCouponDiscount());
    //è¦é‡‡ç”¨å“ªä¸ªç®—æ³•ï¼Œå°±ç”¨å“ªä¸ªç®—æ³•çš„å®ç°ç±»å»å®ä¾‹åŒ–è¿™ä¸ªæ¥å£ï¼Œè¿™é‡Œå…¶å®ä¹Ÿæ˜¯ç”±äºæ³›å‹å’Œæ¥å£çš„æ”¯æ’‘ï¼Œæ‰èƒ½æœ‰è¿™äº›è®¾è®¡æ¨¡å¼
    Map<String,String> mapReq = new HashMap<String, String>();
    mapReq.put("x","100");
    mapReq.put("n","10");
    BigDecimal discountAmount = context.discountAmount(mapReq, new BigDecimal(100));
    logger.info("æµ‹è¯•ç»“æœï¼šæ»¡å‡ä¼˜æƒ åé‡‘é¢ {}", discountAmount);
}

//output

15:43:42.695 [main] INFO  org.itstack.demo.design.test.ApiTest - æµ‹è¯•ç»“æœï¼šæ»¡å‡ä¼˜æƒ åé‡‘é¢ 90

Process finished with exit code 0

```

æ€»ç»“ï¼š

- ä»¥ä¸Šçš„ç­–ç•¥æ¨¡å¼æ¡ˆä¾‹ç›¸å¯¹æ¥è¯´ä¸å¹¶ä¸å¤æ‚ï¼Œä¸»è¦çš„é€»è¾‘éƒ½æ˜¯ä½“ç°åœ¨å…³äºä¸åŒç§ç±»ä¼˜æƒ åˆ¸çš„è®¡ç®—æŠ˜æ‰£ç­–ç•¥ä¸Šã€‚ç»“æ„ç›¸å¯¹æ¥è¯´ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåœ¨å®é™…çš„å¼€å‘ä¸­è¿™æ ·çš„è®¾è®¡æ¨¡å¼ä¹Ÿæ˜¯éå¸¸å¸¸ç”¨çš„ã€‚å¦å¤–è¿™æ ·çš„è®¾è®¡ä¸å‘½ä»¤æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼ç»“æ„ç›¸ä¼¼ï¼Œä½†æ˜¯æ€è·¯æ˜¯æœ‰å·®å¼‚çš„ã€‚
- é€šè¿‡ç­–ç•¥è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨å¯ä»¥æŠŠæˆ‘ä»¬æ–¹æ³•ä¸­çš„ifè¯­å¥ä¼˜åŒ–æ‰ï¼Œå¤§é‡çš„ifè¯­å¥ä½¿ç”¨ä¼šè®©ä»£ç éš¾ä»¥æ‰©å±•ï¼Œä¹Ÿä¸å¥½ç»´æŠ¤ï¼ŒåŒæ—¶åœ¨åæœŸé‡åˆ°å„ç§é—®é¢˜ä¹Ÿå¾ˆéš¾ç»´æŠ¤ã€‚åœ¨ä½¿ç”¨è¿™æ ·çš„è®¾è®¡æ¨¡å¼åå¯ä»¥å¾ˆå¥½çš„æ»¡è¶³éš”ç¦»æ€§ä¸å’Œæ‰©å±•æ€§ï¼Œå¯¹äºä¸æ–­æ–°å¢çš„éœ€æ±‚ä¹Ÿéå¸¸æ–¹ä¾¿æ‰¿æ¥ã€‚
- `ç­–ç•¥æ¨¡å¼`ã€`é€‚é…å™¨æ¨¡å¼`ã€`ç»„åˆæ¨¡å¼`ç­‰ï¼Œåœ¨ä¸€äº›ç»“æ„ä¸Šæ˜¯æ¯”è¾ƒç›¸ä¼¼çš„ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªæ¨¡å¼æ˜¯æœ‰è‡ªå·±çš„é€»è¾‘ç‰¹ç‚¹ï¼Œåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­æœ€ä½³çš„æ–¹å¼æ˜¯ç»è¿‡è¾ƒå¤šçš„å®è·µæ¥å¸å–ç»éªŒï¼Œä¸ºåç»­çš„ç ”å‘è®¾è®¡æä¾›æ›´å¥½çš„æŠ€æœ¯è¾“å‡ºã€‚

## æ¨¡æ¿æ¨¡å¼

æ¨¡æ¿æ¨¡å¼æŒ‡çš„æ˜¯å®šä¹‰ä¸€ä¸ªæ“ä½œçš„ç®—æ³•éª¨æ¶ï¼Œç„¶åå­ç±»ä¸­å¯ä»¥å®ç°è¿™äº›ç®—æ³•çš„æ­¥éª¤ï¼ˆæ¯”å¦‚å®ç°æŸä¸ªæ–¹æ³•ï¼‰ï¼Œä½¿å¾—å­ç±»å¯ä»¥åœ¨ä¸æ”¹å˜ç®—æ³•éª¨æ¶çš„å‰æä¸‹ï¼Œè‡ªå®šä¹‰æŸäº›æ­¥éª¤ï¼Œæ˜¯ä¸€ç§è¡Œä¸ºå‹æ¨¡å¼ã€‚

### åœºæ™¯

è¿™é‡Œä¸¾ä¸€ä¸ªå¾ˆç»å…¸çš„åœºæ™¯ï¼Œçˆ¬è™«ã€‚

> çˆ¬è™«çš„å†™æ³•ä¸€èˆ¬éƒ½æ˜¯ï¼Œloginç™»å½•ç½‘ç«™ï¼Œç„¶åè·å–ä¿¡æ¯ï¼Œç„¶åparseè§£æä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯ç®—æ³•æ˜¯å›ºå®šçš„ï¼Œä½†æ˜¯æ¯ä¸ªç½‘ç«™çš„è§£ææ–¹å¼ï¼Œç™»å½•æ–¹å¼å´ä¸ä¸€æ ·ã€‚

**åœ¨æœ¬æ¡ˆä¾‹ä¸­æˆ‘ä»¬æ¨¡æ‹Ÿçˆ¬è™«å„ç±»ç”µå•†å•†å“ï¼Œç”Ÿæˆè¥é”€æ¨å¹¿æµ·æŠ¥åœºæ™¯**

å…³äºæ¨¡ç‰ˆæ¨¡å¼çš„æ ¸å¿ƒç‚¹åœ¨äºç”±æŠ½è±¡ç±»å®šä¹‰æŠ½è±¡æ–¹æ³•æ‰§è¡Œç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´çˆ¶ç±»è§„å®šäº†å¥½ä¸€ç³»åˆ—çš„æ‰§è¡Œæ ‡å‡†ï¼Œè¿™äº›æ ‡å‡†çš„ä¸²è”æˆä¸€æ•´å¥—ä¸šåŠ¡æµç¨‹ã€‚

> å…¶å®å°±æ˜¯æŠ½è±¡ç±»ä¸­å®šä¹‰æ–¹å¼æ‰§è¡Œé¡ºåºï¼Œç„¶åå­ç±»åœ¨å®ç°è¿™äº›æŠ½è±¡æ–¹æ³•å³å¯ã€‚

#### å®ç°

~~~java
itstack-demo-design-21-00
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ org.itstack.demo.design
    â”‚           â”œâ”€â”€ group
    â”‚           â”‚	  â”œâ”€â”€ DangDangNetMall.java
    â”‚           â”‚	  â”œâ”€â”€ JDNetMall.java
    â”‚           â”‚	  â””â”€â”€ TaoBaoNetMall.java
    â”‚           â”œâ”€â”€  HttpClient.java
    â”‚           â””â”€â”€  NetMall.java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.design.test
                â””â”€â”€ ApiTest.java

~~~

å…¶ä¸­NetMailæ˜¯æŠ½è±¡ç±»ï¼Œä»£è¡¨ç½‘ç«™ã€‚

<img src="https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20240101210210565.png" alt="image-20240101210210565" style="zoom:67%;" />

**ä¸€ä¸ªå®šä¹‰äº†æŠ½è±¡æ–¹æ³•æ‰§è¡Œé¡ºåºçš„æ ¸å¿ƒæŠ½è±¡ç±»ï¼Œä»¥åŠä¸‰ä¸ªæ¨¡æ‹Ÿå…·ä½“çš„å®ç°(`äº¬ä¸œ`ã€`æ·˜å®`ã€`å½“å½“`)çš„ç”µå•†æœåŠ¡ã€‚**

NetMailå®ç°

~~~java
/**
 * åŸºç¡€ç”µå•†æ¨å¹¿æœåŠ¡
 * 1. ç”Ÿæˆæœ€ä¼˜ä»·å•†å“æµ·æŠ¥
 * 2. æµ·æŠ¥å«å¸¦æ¨å¹¿é‚€è¯·ç 
 */
public abstract class NetMall {

    protected Logger logger = LoggerFactory.getLogger(NetMall.class);

    String uId;   // ç”¨æˆ·ID
    String uPwd;  // ç”¨æˆ·å¯†ç 

    public NetMall(String uId, String uPwd) {
        this.uId = uId;
        this.uPwd = uPwd;
    }

    /**
     * ç”Ÿæˆå•†å“æ¨å¹¿æµ·æŠ¥
     *
     * @param skuUrl å•†å“åœ°å€(äº¬ä¸œã€æ·˜å®ã€å½“å½“)
     * @return æµ·æŠ¥å›¾ç‰‡base64ä½ä¿¡æ¯
     */
    public String generateGoodsPoster(String skuUrl) {
        if (!login(uId, uPwd)) return null;             // 1. éªŒè¯ç™»å½•
        Map<String, String> reptile = reptile(skuUrl);  // 2. çˆ¬è™«å•†å“
        return createBase64(reptile);                   // 3. ç»„è£…æµ·æŠ¥
    }

    // æ¨¡æ‹Ÿç™»å½•
    protected abstract Boolean login(String uId, String uPwd);

    // çˆ¬è™«æå–å•†å“ä¿¡æ¯(ç™»å½•åçš„ä¼˜æƒ ä»·æ ¼)
    protected abstract Map<String, String> reptile(String skuUrl);

    // ç”Ÿæˆå•†å“æµ·æŠ¥ä¿¡æ¯
    protected abstract String createBase64(Map<String, String> goodsInfo);

}

~~~

ä¸‹é¢å¯¹äºä¸åŒç½‘ç«™ï¼Œå°±åªéœ€è¦å®ç°è¿™é‡Œé¢çš„æ–¹æ³•å³å¯ã€‚

ä»¥äº¬ä¸œä¸ºä¾‹

~~~java
public class JDNetMall extends NetMall {

    public JDNetMall(String uId, String uPwd) {
        super(uId, uPwd);
    }

    public Boolean login(String uId, String uPwd) {
        logger.info("æ¨¡æ‹Ÿäº¬ä¸œç”¨æˆ·ç™»å½• uIdï¼š{} uPwdï¼š{}", uId, uPwd);
        return true;
    }

    public Map<String, String> reptile(String skuUrl) {
        String str = HttpClient.doGet(skuUrl);
        Pattern p9 = Pattern.compile("(?<=title\\>).*(?=</title)");
        Matcher m9 = p9.matcher(str);
        Map<String, String> map = new ConcurrentHashMap<String, String>();
        if (m9.find()) {
            map.put("name", m9.group());
        }
        map.put("price", "5999.00");
        logger.info("æ¨¡æ‹Ÿäº¬ä¸œå•†å“çˆ¬è™«è§£æï¼š{} | {} å…ƒ {}", map.get("name"), map.get("price"), skuUrl);
        return map;
    }

    public String createBase64(Map<String, String> goodsInfo) {
        BASE64Encoder encoder = new BASE64Encoder();
        logger.info("æ¨¡æ‹Ÿç”Ÿæˆäº¬ä¸œå•†å“base64æµ·æŠ¥");
        return encoder.encode(JSON.toJSONString(goodsInfo).getBytes());
    }

}

~~~

**æ€»ç»“**

- é€šè¿‡ä¸Šé¢çš„å®ç°å¯ä»¥çœ‹åˆ°`æ¨¡ç‰ˆæ¨¡å¼`åœ¨å®šä¹‰ç»Ÿä¸€ç»“æ„ä¹Ÿå°±æ˜¯æ‰§è¡Œæ ‡å‡†ä¸Šéå¸¸æ–¹ä¾¿ï¼Œä¹Ÿå°±å¾ˆå¥½çš„æ§åˆ¶äº†åç»­çš„å®ç°è€…ä¸ç”¨å…³å¿ƒè°ƒç”¨é€»è¾‘ï¼ŒæŒ‰ç…§ç»Ÿä¸€æ–¹å¼æ‰§è¡Œã€‚é‚£ä¹ˆç±»çš„ç»§æ‰¿è€…åªéœ€è¦å…³å¿ƒå…·ä½“çš„ä¸šåŠ¡é€»è¾‘å®ç°å³å¯ã€‚
- å¦å¤–æ¨¡ç‰ˆæ¨¡å¼ä¹Ÿæ˜¯ä¸ºäº†è§£å†³å­ç±»é€šç”¨æ–¹æ³•ï¼Œæ”¾åˆ°çˆ¶ç±»ä¸­è®¾è®¡çš„ä¼˜åŒ–ã€‚è®©æ¯ä¸€ä¸ªå­ç±»åªåšå­ç±»éœ€è¦å®Œæˆçš„å†…å®¹ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…¶ä»–é€»è¾‘ã€‚è¿™æ ·æå–å…¬ç”¨ä»£ç ï¼Œè¡Œä¸ºç”±çˆ¶ç±»ç®¡ç†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ï¼Œä¹Ÿå°±éå¸¸æœ‰åˆ©äºå¼€å‘æ‹“å±•å’Œè¿­ä»£ã€‚