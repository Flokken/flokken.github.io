---
title: 一些常用的docker命令
date: 2023-04-05 00:00:00
tags: 
  - null
categories: 
  - 其他
  - 小知识
permalink: /pages/80f632/
---

## 查找镜像和容器

`docker ps`

`docker exec -it 947b /bin/bash` 在bash里控制容器

docker stop ID

docker restart ID

docker logs Id  #查看某个容器运行日志

docker ps - a grep | name #根据名字查找容器

## **删除容器：**

首先需要停止容器

```bash
docker stop id
```

删除容器

```bash
docker rm  id
```

## **删除镜像：**

`docker rmi id`

> docker中一般都要设置配置文件，可以使用vim来完成，记录一些vim操作

**vim 复制所有**
	ggvG,选中全部

​	yy，把选中内容复制到临时区

​	P（大写），复制

vim 打开新文件

​	:n a.txt    命令模式下:n  文件名，即可切换到新文件

## 查看镜像日志

```bash
docker logs -f -t --since="2023-01-01" --tail=50  45505813ce0b（容器的名称，即NAMES）
```

> -f 参数是持续查看日志
>
> docker logs --help 查看帮助

## 进入容器 bash

首先要保证容器处于启动状态

如果没有启动，可以`docker start name/id`

之后用如下命令进入bash

 `docker exec -i -t name/id /bin/bash`

exit可以退出

但是一般docker镜像里没有可以编辑文件的工具，此时可以使用docker cp命令把数据拷贝到主机，修改了在拷贝回去

`docker cp id:/www /tmp`把docker的id容器的/www目录拷贝到/tmp目录

如果要拷贝回去，只需要对调一下目录位置即可也就是`docker cp /tmp id:/www `

## 目录映射



## springboot docker 部署

首先再maven的setting中添加依赖

> D:\apache-maven-3.9.0-bin\apache-maven-3.9.0\conf

~~~xml
 <pluginGroups>
    <!-- pluginGroup
     | Specifies a further group identifier to use for plugin lookup.
    <pluginGroup>com.your.plugins</pluginGroup>
    
    -->
     <pluginGroup>com.spotify</pluginGroup>
  </pluginGroups>
~~~



然后再项目的main下面建一个docker的包，并创建文件dockerfile，放在根目录

![image-20230602110917912](https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230602110917912.png)

编写dockerfile

~~~dockerfile
# 该镜像需要依赖的基础镜像
FROM openjdk:17
VOLUME /tmp
COPY  target/sbomDataGet-0.0.1-SNAPSHOT sbomDataGet.jar
EXPOSE 8086
ENTRYPOINT ["java", "-jar","/sbomDataGet.jar"]

~~~

注意：

- 上面用到了openjdk:17,就必须先在本地拉取了才能构建，不然报错，注意docker下载jdk的话，可以去直接`docker pull openjdk:17`（因为有openjdk维护jdk的仓库）
- ![image-20230602105540686](https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230602105540686.png)

mvn clean package dockerfile:build

> 可惜这样没成功

###  先打包为jar包，再用docker命令打包

先打包jar包，

![image-20230602112227508](https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230602112227508.png)

新建一个Dockerfile

~~~dockerfile
FROM openjdk:17

EXPOSE 8086

WORKDIR /src

COPY  target/sbomDataGet-*.jar sbomDataGet.jar

ENTRYPOINT ["java", "-jar", "sbomDataGet.jar"]

~~~

这里可以在本地打包，也可以上传到服务器打包

一般来说本地打包的docker比较大，所以最好上传jar包去服务器打包

两者后面的步骤完全相同，dockerfile可能有一点差异



**必须先把jdk拉到本地**

> 上面用到了openjdk:17,就必须先在本地拉取了才能构建，不然报错，注意docker下载jdk的话，可以去直接`docker pull openjdk:17`（因为有openjdk维护jdk的仓库）

然后到Dockerfile的目录

`docker build -t sbom-data-get .  `

> 注意docker名字一般小写

镜像位置查看

![image-20230602112847059](https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230602112847059.png)

它是放在虚拟环境中的，如果要导出镜像（tar文件），再放到服务器。

`docker save -o sbom-data-get.tar sbom-data-get:latest`

>会把镜像放在当前目录

然后服务器上加载上传的image(先到镜像目录)

```undefined
docker load --input sbom-data-get.tar
```

运行docker（后台运行）

`docker run -d -p 8086:8086 sbom-data-get`

> 加-d 后台，否则前台，关了bash就停止
