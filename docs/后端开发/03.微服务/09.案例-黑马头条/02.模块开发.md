---
title: 模块开发
date: 2023-08-09
categories: 
  - 后端开发
  - 微服务	
  - 案例-黑马头条
---

## 登录

表结构，ap_user表

![image-20230809091447687](https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230809091447687.png)

实体类

如上一节所示，放在model这个包里

![image-20230809090456705](https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230809090456914.png)

项目中的持久层使用的mybatis-plus，一般都使用mybais-plus逆向生成对应的实体类

~~~java
package com.heima.model.user.pojos;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

import java.io.Serializable;
import java.util.Date;

/**
 * <p>
 * APP用户信息表
 * </p>
 *
 * @author itheima
 */
@Data
@TableName("ap_user")
public class ApUser implements Serializable {

    private static final long serialVersionUID = 1L;

    /**
     * 主键
     */
    @TableId(value = "id", type = IdType.AUTO)
    private Integer id;

    /**
     * 密码、通信等加密盐
     */
    @TableField("salt")
    private String salt;

    /**
     * 用户名
     */
    @TableField("name")
    private String name;

    /**
     * 密码,md5加密
     */
    @TableField("password")
    private String password;

    /**
     * 手机号
     */
    @TableField("phone")
    private String phone;

    /**
     * 头像
     */
    @TableField("image")
    private String image;

    /**
     * 0 男
            1 女
            2 未知
     */
    @TableField("sex")
    private Boolean sex;

    /**
     * 0 未
            1 是
     */
    @TableField("is_certification")
    private Boolean certification;

    /**
     * 是否身份认证
     */
    @TableField("is_identity_authentication")
    private Boolean identityAuthentication;

    /**
     * 0正常
            1锁定
     */
    @TableField("status")
    private Boolean status;

    /**
     * 0 普通用户
            1 自媒体人
            2 大V
     */
    @TableField("flag")
    private Short flag;

    /**
     * 注册时间
     */
    @TableField("created_time")
    private Date createdTime;

}
~~~

### 加密

虽然MD5是不可逆加密，但是对于同样的字符串，md5产生的密码也是一样的。

可以在md5的基础上手动加盐（salt）处理

注册->生成盐

<img src="https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230809093405024.png" style="zoom:70%">

登录->使用盐来配合验证



<img src="https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230809093514960.png" style="zoom:70%">

> 一句话解释就是，对于每个用户的密码，存的是它本身的密码加一个salt经过md5加密后的东西（更安全）
>
> 登录时，就是从数据库这个用户中读取salt，然后组合这个用户输入的密码来md5加密，再和数据中这个用户存的盐加密后的密码比对即可



### 登录分析

<img src="https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20210412142536782.png" style="zoom:80%">

1，用户输入了用户名和密码进行登录，校验成功后返回jwt(基于当前用户的id生成)

2，用户游客登录，生成jwt返回(基于默认值0生成)‘

#### JWT

>https://blog.csdn.net/weixin_45410366/article/details/125031959
>
>https://www.cnblogs.com/limengda/p/11127712.html

JWT (全称：**Json Web Token**)是一个开放标准(RFC 7519)，它定义了一种紧凑的、自包含的方式，用于作为 JSON 对象在各方之间安全地传输信息。该信息可以被验证和信任，因为它是数字签名的。

jwt验证方式是将用户信息通过加密生成token，每次请求服务端只需要使用保存的密钥验证token的正确性，不用再保存任何session数据了，进而服务端变得无状态，容易实现拓展。

**JWT的数据结构**

JWT 一般是这样一个字符串，分为三个部分，以 “.” 隔开：

```text
xxxxx.yyyyy.zzzzz
```

### 微服务

那么提供登录的服务写在哪？这次是一个微服务项目，把相关的功能都分成微服务了，在service下面创建对于模块/微服务

![image-20230809095910871](https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230809095910871.png)