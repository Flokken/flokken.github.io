---
title: java反射
date: 2023-04-19 00:00:00
tags: 
  - Java
categories: 
  - 后端开发
  - Java开发
  - JavaSE
---

## 反射是什么？

反射的概念是由Smith在1982年首次提出的，主要是指程序可以**访问、检测和修改它本身状态或行为的一种能力。**

在计算机科学领域，反射是指一类应用，它们能够自描述和自控制。也就是说，**这类应用通过采用某种机制来实现对自己行为的描述**（self-representation）和监测（examination），并能根据自身行为的状态和结果，调整或修改应用所描述行为的状态和相关的语义。

> 看了一些教程，好像比较复杂，这里先写一个大概，以后慢慢补充。

### Java反射有什么用

```text
在运行时判断任意一个对象所属的类。
在运行时构造任意一个类的对象。
在运行时判断任意一个类所具有的成员变量和方法。
在运行时调用任意一个对象的方法
```

### 如何理解

首先可以理解什么叫“正”，一般来说，**一般而言，当用户使用一个类的时候，应该先知道这个类，而后通过这个类产生实例化对象，但是“反”指的是通过对象找到类。**

~~~java
Person per = newPerson() ; // 正着操作
System.out.println(per.getClass().getName()); // 反着来
~~~

这里的getClass()方法，就可以得到对象所在的类的"包.类"。也是JDK 提供的反射 API

这里给出先一个看到的定义：

**反射就是在运行时才知道要操作的类是什么，并且可以在运行时获取类的完整构造，并调用对应的方法**。

#### **一个简单的例子**

上面提到的示例程序，其完整的程序代码如下：

```java
public class Apple {

    private int price;

    public int getPrice() {
        return price;
    }

    public void setPrice(int price) {
        this.price = price;
    }

    public static void main(String[] args) throws Exception{
        //正常的调用
        Apple apple = new Apple();
        apple.setPrice(5);
        System.out.println("Apple Price:" + apple.getPrice());
        //使用反射调用
        Class clz = Class.forName("com.chenshuyi.api.Apple");
        Method setPriceMethod = clz.getMethod("setPrice", int.class);
        Constructor appleConstructor = clz.getConstructor();
        Object appleObj = appleConstructor.newInstance();
        setPriceMethod.invoke(appleObj, 14);
        Method getPriceMethod = clz.getMethod("getPrice");
        System.out.println("Apple Price:" + getPriceMethod.invoke(appleObj));
    }
}
```

从代码中可以看到我们使用反射调用了 setPrice 方法，并传递了 14 的值。之后使用反射调用了 getPrice 方法，输出其价格。上面的代码整个的输出结果是：

```java
Apple Price:5
Apple Price:14
```

从这个简单的例子可以看出，一般情况下我们使用反射获取一个对象的步骤：

- 获取类的 Class 对象实例

```text
Class clz = Class.forName("com.zhenai.api.Apple");
```

- 根据 Class 对象实例获取 Constructor 对象

```java
Constructor appleConstructor = clz.getConstructor();
```

- 使用 Constructor 对象的 newInstance 方法获取反射类对象

```text
Object appleObj = appleConstructor.newInstance();
```

而如果要调用某一个方法，则需要经过下面的步骤：

- 获取方法的 Method 对象

```java
Method setPriceMethod = clz.getMethod("setPrice", int.class);
```

- 利用 invoke 方法调用方法

```java
setPriceMethod.invoke(appleObj, 14);
```

上面就可以看到基本的反射使用了，但是还是不理解其内部。

> 可参考https://www.zhihu.com/question/24304289

#### 反射常用API

Java的反射机制的实现要借助于4个类：class，Constructor，Field，Method;

