---
title: SpringMVC简介
date: 2023-04-26
tags: 
  - Java
categories: 
  - 后端开发
  - Java开发
  - SSM
---

## SpringMVC（Model View Controller）简介

SpringMVC是隶属于Spring框架的一部分，主要是用来进行Web开发，是对Servlet进行了封装。

SpringMVC是处于Web层的框架，所以其主要的作用就是用来接收前端发过来的请求和数据然后经过处理并将处理的结果响应给前端。

SpringMVC我们主要学习如下内容:

* SpringMVC简介
* 请求与响应
* REST风格
* SSM整合(注解开发)
* 拦截器

### web程序三层架构

web经典三层架构，对应java web的结构

- 数据访问层(Dao)：对数据库的CRUD等操作
- 业务逻辑层(Service)：对业务逻辑进行封装，组合数据访问层层中基本功能，形成复杂的业务逻辑功能。
- 表现层(Controller)：接收请求，封装数据，调用业务逻辑层，响应数据

现在的web应用多是**异步调用**，前端通过异步调用的方式进行交互，后台就需要将返回的数据转换成json格式进行返回





<img src="https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230426171545411.png" style="zoom:70%">

* SpringMVC主要负责的就是
  * controller如何接收请求和数据
  * 如何将请求和数据转发给业务层
  * 如何将响应数据转换成json发回到前端

给SpringMVC进行一个定义

* SpringMVC是一种基于Java实现MVC模型的轻量级Web框架（基于Servlet）

### 入门案例

回忆Servlet创建项目

1.创建web工程(Maven结构)

2.设置tomcat服务器，加载web工程(tomcat插件)

3.导入坐标(Servlet)

4.定义处理请求的功能类(UserServlet)

5.设置请求映射(配置映射关系)

**SpringMVC的制作过程和上述流程几乎是一致的，具体的实现流程是什么?**

1.创建web工程(Maven结构)

2.设置tomcat服务器，加载web工程(tomcat插件)

3.导入坐标(SpringMVC+Servlet)

4.定义处理请求的功能类(UserController)

5.**设置请求映射(配置映射关系)**

6.将SpringMVC设定加载到Tomcat容器中

#### 1 创建项目（通过骨架）

<img src="https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230426202611999.png" style="zoom:70%">

自动创建文件结构如下

![image-20230426202655498](https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230426202655498.png)

但是没有java目录，所以要新建一个（右键new会推荐这个，并且会自动把他设置成源码目录）

![image-20230426202938858](https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230426202938858.png)



2 导入jar包

~~~xml
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <groupId>org.example</groupId>
  <artifactId>springmvc_demo</artifactId>
  <packaging>war</packaging>
  <version>1.0-SNAPSHOT</version>
  <name>springmvc_demo Maven Webapp</name>
  <url>http://maven.apache.org</url>
  <dependencies>
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>3.8.1</version>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>springframework</groupId>
      <artifactId>spring-webmvc</artifactId>
      <version>1.2.5</version>
    </dependency>
    <dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>javax.servlet-api</artifactId>
      <version>3.1.0</version>
      <scope>provided</scope>
    </dependency>
  </dependencies>

  <build>
    <finalName>springmvc_demo</finalName>
    <plugins>
      <plugin>
        <groupId>org.apache.tomcat.maven</groupId>
        <artifactId>tomcat7-maven-plugin</artifactId>
        <version>2.1</version>
        <configuration>
          <port>80</port>
          <path>/</path>
        </configuration>
      </plugin>
    </plugins>
  </build>
</project>
~~~



**说明:**servlet的坐标为什么需要添加`<scope>provided</scope>`?

* scope是maven中jar包依赖作用范围的描述，
* 如果不设置默认是`compile`在在编译、运行、测试时均有效
* 如果运行有效的话就会和tomcat中的servlet-api包发生冲突，导致启动报错

* provided代表的是该包只在编译和测试的时候用，运行的时候无效直接使用tomcat中的，就避免冲突

#### 2 创建配置类

~~~java
@Configuration
@ComponentScan("com.test.controller")
public class SpringMvcConfig {
}
~~~

#### 创建Controller类

```java
@Controller
public class UserController {
    
    @RequestMapping("/save")
    public void save(){
        System.out.println("user save ...");
    }
}

```

#### 步骤6:使用配置类替换web.xml

将web.xml删除，换成ServletContainersInitConfig

```java
public class ServletContainersInitConfig extends AbstractDispatcherServletInitializer {
    //加载springmvc配置类
    protected WebApplicationContext createServletApplicationContext() {
        //初始化WebApplicationContext对象
        AnnotationConfigWebApplicationContext ctx = new AnnotationConfigWebApplicationContext();
        //加载指定配置类
        ctx.register(SpringMvcConfig.class);
        return ctx;
    }

    //设置由springmvc控制器处理的请求映射路径
    protected String[] getServletMappings() {
        return new String[]{"/"};
    }

    //加载spring配置类
    protected WebApplicationContext createRootApplicationContext() {
        return null;
    }
}
```

#### 步骤7:配置Tomcat环境

这里很坑，因为教程教的过时了，搞了很久。首先pom里添加tomcat

~~~xml
  <build>
    <finalName>springmvc_demo</finalName>
    <plugins>
      <plugin>
        <groupId>org.apache.tomcat.maven</groupId>
        <artifactId>tomcat7-maven-plugin</artifactId>
        <version>2.2</version>
        <configuration>
          <port>80</port>
          <path>/</path>
        </configuration>
      </plugin>
    </plugins>
  </build>
~~~

然后可能会报编译complication failure ,提示用6或者以上版本

显然是jdk版本太低，我一开始去这setting里设置，但是还是不行（重启还是这个错，可能是ideabug）

![image-20230426214100564](https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230426214100564.png)

搜到一种办法，在pom里添加依赖可以直接maven编译时用那种jdk

~~~xml
  <properties>
    <!-- dependency前面 -->
    <maven.compiler.target>11</maven.compiler.target>
    <maven.compiler.source>11</maven.compiler.source>
  </properties>
~~~

然后用maven运行项目

如果tomcat正常启动

![image-20230426214958820](https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230426214958820.png)

访问localhost:80

![image-20230426215028280](https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230426215028280.png)

#### 步骤8:设置返回数据为json

```java
@Controller
public class UserController {
    
    @RequestMapping("/save")
    @ResponseBody
    public String save(){
        System.out.println("user save ...");
        return "{'info':'springmvc'}";
    }
}

```

localhost:80/save可以看到

![image-20230426215553624](https://typora-1309665611.cos.ap-nanjing.myqcloud.com/typora/image-20230426215553624.png)

#### 知识点1：@Controller

| 名称 | @Controller                   |
| ---- | ----------------------------- |
| 类型 | 类注解                        |
| 位置 | SpringMVC控制器类定义上方     |
| 作用 | 设定SpringMVC的核心控制器bean |

#### 知识点2：@RequestMapping

| 名称     | @RequestMapping                 |
| -------- | ------------------------------- |
| 类型     | 类注解或方法注解                |
| 位置     | SpringMVC控制器类或方法定义上方 |
| 作用     | 设置当前控制器方法请求访问路径  |
| 相关属性 | value(默认)，请求访问路径       |

#### 知识点3：@ResponseBody

| 名称 | @ResponseBody                                    |
| ---- | ------------------------------------------------ |
| 类型 | 类注解或方法注解                                 |
| 位置 | SpringMVC控制器类或方法定义上方                  |
| 作用 | 设置当前控制器方法响应内容为当前返回值，无需解析 |

### 流程分析



<img src="" style="zoom:70%">

<img src="" style="zoom:70%">

<img src="" style="zoom:70%">

<img src="" style="zoom:70%">

<img src="" style="zoom:70%">

<img src="" style="zoom:70%">

<img src="" style="zoom:70%">



